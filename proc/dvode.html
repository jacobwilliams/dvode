<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Modern Fortran Edition of the DVODE ODE Solver">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>dvode &ndash; dvode</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">dvode </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>dvode
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title="26.7% of total for procedures.">558 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/dvode_module.F90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/dvode_module.f90.html'>dvode_module.F90</a></li>
                <li class="breadcrumb-item"><a href='../module/dvode_module.html'>dvode_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">dvode</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/dvode.html#src">dvode</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public  subroutine dvode(me, neq, y, t, tout, itol, rtol, atol, itask, istate, iopt, rwork, lrw, iwork, liw, mf)  
</h2>
    

    <p>dvode: variable-coefficient ordinary differential equation solver,
  with fixed-leading-coefficient implementation.</p>
<p>dvode solves the initial value problem for stiff or nonstiff
  systems of first order odes:</p>
<p>
<script type="math/tex; mode=display"> \frac{d}{dt} \mathbf{y} = \mathbf{f}(t,\mathbf{y}) </script>
</p>
<p>or, in component form:</p>
<p>
<script type="math/tex; mode=display"> \frac{d}{dt} \left[ \begin{array}{c} y_1 \\ y_2 \\ \vdots \\ y_{n_{eq}} \end{array} \right] = \left[ \begin{array}{c} f_1 \\ f_2 \\ \vdots \\ f_{n_{eq}} \end{array} \right] = \left[ \begin{array}{c} f(t,y_1) \\ f(t,y_2) \\ \vdots \\ f(t,y_{n_{eq}}) \end{array} \right] </script>
</p>
<p>dvode is a package based on the <code>episode</code> and <code>episodeb</code> packages, and
  on the <code>odepack</code> user interface standard, with minor modifications.</p>
<h3>Interrupting and restarting</h3>
<p>if the integration of a given problem by dvode is to be
 interrrupted and then later continued, such as when restarting
 an interrupted run or alternating between two or more ode problems,
 the user should save, following the return from the last dvode call
 prior to the interruption, the contents of the call sequence
 variables and internal variables, and later restore these
 values before the next dvode call for that problem.  to save
 and restore the variables, use subroutine <a href="../proc/dvsrco.html">dvsrco</a>.</p>
<p>in addition, if non-default values for either <code>lun</code> or <code>mflag</code> are
 desired, an extra call to <a href="../proc/xsetun.html">xsetun</a> and/or <a href="../proc/xsetf.html">xsetf</a> should be made just
 before continuing the integration.</p>
<h3>Authors:</h3>
<ul>
<li>peter n. brown and alan c. hindmarsh,
    center for applied scientific computing, l-561,
    lawrence livermore national laboratory,
    livermore, ca 94551</li>
<li>george d. byrne,
    illinois institute of technology,
    chicago, il 60616</li>
</ul>
<h3>References</h3>
<ol>
<li>p. n. brown, g. d. byrne, and a. c. hindmarsh, "vode: a variable
     coefficient ode solver," siam j. sci. stat. comput., 10 (1989),
     pp. 1038-1051.  also, llnl report ucrl-98412, june 1988.</li>
<li>g. d. byrne and a. c. hindmarsh, "a polyalgorithm for the
     numerical solution of ordinary differential equations,"
     acm trans. math. software, 1 (1975), pp. 71-96.</li>
<li>a. c. hindmarsh and g. d. byrne, "episode: an effective package
     for the integration of systems of ordinary differential
     equations," llnl report ucid-30112, rev. 1, april 1977.</li>
<li>g. d. byrne and a. c. hindmarsh, "episodeb: an experimental
     package for the integration of systems of ordinary differential
     equations with banded jacobians," llnl report ucid-30132, april
     1976.</li>
<li>a. c. hindmarsh, "odepack, a systematized collection of ode
     solvers," in scientific computing, r. s. stepleman et al., eds.,
     north-holland, amsterdam, 1983, pp. 55-64.</li>
<li>k. r. jackson and r. sacks-davis, "an alternative implementation
     of variable step-size multistep formulas for stiff odes," acm
     trans. math. software, 6 (1980), pp. 295-318.</li>
</ol>
<h3>Revision history</h3>
<ul>
<li>19890615  date written.  initial release.</li>
<li>19890922  added interrupt/restart ability, minor changes throughout.</li>
<li>19910228  minor revisions in line format,  prologue, etc.</li>
<li>19920227  modifications by d. pang:
              (1) applied subgennam to get generic intrinsic names.
              (2) changed intrinsic names to generic in comments.
              (3) added *deck lines before each routine.</li>
<li>19920721  names of routines and labeled common blocks changed, so as
              to be unique in combined single/real(wp) code (ach).</li>
<li>19920722  minor revisions to prologue (ach).</li>
<li>19920831  conversion to real(wp) done (ach).</li>
<li>19921106  fixed minor bug: etaq,etaqm1 in dvstep save statement (ach).</li>
<li>19921118  changed lunsav/mflgsv to ixsav (ach).</li>
<li>19941222  removed mf overwrite; attached sign to h in estimated second
              deriv. in dvhin; misc. comment changes throughout (ach).</li>
<li>19970515  minor corrections to comments in prologue, dvjac (ach).</li>
<li>19981111  corrected block b by adding final line, go to 200 (ach).</li>
<li>20020430  various upgrades (ach): use odepack error handler package.
              replaced d1mach by dumach.  various changes to main
              prologue and other routine prologues.</li>
</ul>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>the legality of input parameters will be thoroughly checked on the
      initial call for the problem, but not checked thereafter unless a
      change in input parameters is flagged by <code>istate = 3</code> in the input.</p>
</div>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>the work arrays must not be altered between calls to <a href="../proc/dvode.html">dvode</a>
      for the same problem, except possibly for the conditional and
      optional input, and except for the last <code>3*neq</code> words of <code>rwork</code>.
      the latter space is used for internal scratch space, and so is
      available for use by the user outside <a href="../proc/dvode.html">dvode</a> between calls, if
      desired (but not for use by <code>f</code> or <code>jac</code>).</p>
</div>

    <h3>Type Bound</h3>
    <p><a href='../type/dvode_t.html'>dvode_t</a></p>

    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-me~6"></span>
              class(<a href='../type/dvode_t.html'>dvode_t</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>me</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-neq~3"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>neq</strong></td>
            <td>
                <p>the size of the ode system (number of first order
ordinary differential equations).
<code>neq</code> may not be increased during the problem, but
can be decreased (with <code>istate = 3</code> in the input).</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-y~3"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>y</strong>(*)</td>
            <td>
                <p>a real array for the vector of dependent variables, of
length <code>neq</code> or more.  used for both input and output on the
first call (<code>istate = 1</code>), and only for output on other calls.
on the first call, <code>y</code> must contain the vector of initial
values.  in the output, <code>y</code> contains the computed solution
evaluated at <code>t</code>.  if desired, the <code>y</code> array may be used
for other purposes between calls to the solver.</p>
<p>this array is passed as the <code>y</code> argument in all calls to
<code>f</code> and <code>jac</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~7"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>t</strong></td>
            <td>
                <p>the independent variable.  in the input, <code>t</code> is used only on
the first call, as the initial point of the integration.
in the output, after each call, <code>t</code> is the value at which a
computed solution <code>y</code> is evaluated (usually the same as <code>tout</code>).
on an error return, <code>t</code> is the farthest point reached.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tout"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>tout</strong></td>
            <td>
                <p>the next value of <code>t</code> at which a computed solution is desired.</p>
<p>when starting the problem (<code>istate = 1</code>), <code>tout</code> may be equal
to <code>t</code> for one call, then should <code>/= t</code> for the next call.
for the initial <code>t</code>, an input value of <code>tout /= t</code> is used
in order to determine the direction of the integration
(i.e. the algebraic sign of the step sizes) and the rough
scale of the problem.  integration in either direction
(forward or backward in <code>t</code>) is permitted.</p>
<p>if <code>itask = 2 or 5</code> (one-step modes), <code>tout</code> is ignored after
the first call (i.e. the first call with <code>tout /= t</code>).
otherwise, <code>tout</code> is required on every call.</p>
<p>if <code>itask = 1, 3, or 4</code>, the values of <code>tout</code> need not be
monotone, but a value of <code>tout</code> which backs up is limited
to the current internal <code>t</code> interval, whose endpoints are
<code>tcur - hu</code> and <code>tcur</code>.  (see optional output, below, for
<code>tcur</code> and <code>hu</code>.)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-itol~2"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>itol</strong></td>
            <td>
                <p>an indicator for the type of error control.
1 or 2 according as <code>atol</code> is a scalar or array.
see description under <code>atol</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rtol~2"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rtol</strong>(*)</td>
            <td>
                <p>a relative error tolerance parameter, either a scalar or
an array of length <code>neq</code>.  see description under <code>atol</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-atol~2"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>atol</strong>(*)</td>
            <td>
                <p>an absolute error tolerance parameter, either a scalar or
 an array of length <code>neq</code>.</p>
<p>the input parameters <code>itol</code>, <code>rtol</code>, and <code>atol</code> determine
 the error control performed by the solver.  the solver will
 control the vector <code>e = (e(i))</code> of estimated local errors
 in <code>y</code>, according to an inequality of the form</p>
<div class="codehilite"><pre><span></span><code>        rms-norm of ( e(i)/ewt(i) )   &lt;=   1,
 where  ewt(i) = rtol(i)*abs(y(i)) + atol(i),
</code></pre></div>

<p>and the rms-norm (root-mean-square norm) here is
 <code>rms-norm(v) = sqrt(sum v(i)**2 / neq)</code>.  here <code>ewt = (ewt(i))</code>
 is a vector of weights which must always be positive, and
 the values of <code>rtol</code> and <code>atol</code> should all be non-negative.
 the following table gives the types (scalar/array) of
 <code>rtol</code> and <code>atol</code>, and the corresponding form of <code>ewt(i)</code>.</p>
<div class="codehilite"><pre><span></span><code>    itol    rtol       atol          ewt(i)
     1     scalar     scalar     rtol*abs(y(i)) + atol
     2     scalar     array      rtol*abs(y(i)) + atol(i)
     3     array      scalar     rtol(i)*abs(y(i)) + atol
     4     array      array      rtol(i)*abs(y(i)) + atol(i)
</code></pre></div>

<p>when either of these parameters is a scalar, it need not
 be dimensioned in the user's calling program.</p>
<p>if none of the above choices (with <code>itol</code>, <code>rtol</code>, and <code>atol</code>
 fixed throughout the problem) is suitable, more general
 error controls can be obtained by substituting
 user-supplied routines for the setting of <code>ewt</code> and/or for
 the norm calculation.</p>
<p>if global errors are to be estimated by making a repeated
 run on the same problem with smaller tolerances, then all
 components of <code>rtol</code> and <code>atol</code> (i.e. of <code>ewt</code>) should be scaled
 down uniformly.</p>
<p>use <code>rtol = 0.0</code> for pure absolute error control, and
 use <code>atol = 0.0</code> (or <code>atol(i) = 0.0</code>) for pure relative error
 control.  caution: actual (global) errors may exceed these
 local tolerances, so choose them conservatively.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-itask"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>itask</strong></td>
            <td>
                <p>an index specifying the task to be performed.
input only.  itask has the following values and meanings:</p>
<ul>
<li>1  means normal computation of output values of y(t) at
      t = tout (by overshooting and interpolating).</li>
<li>2  means take one step only and return.</li>
<li>3  means stop at the first internal mesh point at or
     beyond t = tout and return.</li>
<li>4  means normal computation of output values of y(t) at
     t = tout but without overshooting t = tcrit.
     tcrit must be input as rwork(1).  tcrit may be equal to
     or beyond tout, but not behind it in the direction of
     integration.  this option is useful if the problem
     has a singularity at or beyond t = tcrit.</li>
<li>5  means take one step, without passing tcrit, and return.
     tcrit must be input as rwork(1).</li>
</ul>
<p>note:  if itask = 4 or 5 and the solver reaches tcrit
(within roundoff), it will return t = tcrit (exactly) to
indicate this (unless itask = 4 and tout comes before tcrit,
in which case answers at t = tout are returned first).</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-istate"></span>
              integer,
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>istate</strong></td>
            <td>
                <p>an index used for input and output to specify the
the state of the calculation.</p>
<p>in the input, the values of istate are as follows:</p>
<ol>
<li>means this is the first call for the problem
     (initializations will be done).  see note below.</li>
<li>means this is not the first call, and the calculation
     is to continue normally, with no change in any input
     parameters except possibly tout and itask.
     (if itol, rtol, and/or atol are changed between calls
     with istate = 2, the new values will be used but not
     tested for legality.)</li>
<li>means this is not the first call, and the
     calculation is to continue normally, but with
     a change in input parameters other than
     tout and itask.  changes are allowed in
     neq, itol, rtol, atol, iopt, lrw, liw, mf, ml, mu,
     and any of the optional input except h0.
     (see iwork description for ml and mu.)</li>
</ol>
<p>note:  a preliminary call with tout = t is not counted
as a first call here, as no initialization or checking of
input is done.  (such a call is sometimes useful to include
the initial conditions in the output.)
thus the first call for which tout /= t requires
istate = 1 in the input.</p>
<p>in the output, istate has the following values and meanings:</p>
<ul>
<li>1  means nothing was done, as tout was equal to t with
     istate = 1 in the input.</li>
<li>2  means the integration was performed successfully.</li>
<li>-1  means an excessive amount of work (more than mxstep
      steps) was done on this call, before completing the
      requested task, but the integration was otherwise
      successful as far as t.  (mxstep is an optional input
      and is normally 500.)  to continue, the user may
      simply reset istate to a value &gt; 1 and call again.
      (the excess work step counter will be reset to 0.)
      in addition, the user may increase mxstep to avoid
      this error return.  (see optional input below.)</li>
<li>-2  means too much accuracy was requested for the precision
      of the machine being used.  this was detected before
      completing the requested task, but the integration
      was successful as far as t.  to continue, the tolerance
      parameters must be reset, and istate must be set
      to 3.  the optional output tolsf may be used for this
      purpose.  (note: if this condition is detected before
      taking any steps, then an illegal input return
      (istate = -3) occurs instead.)</li>
<li>-3  means illegal input was detected, before taking any
      integration steps.  see written message for details.
      note:  if the solver detects an infinite loop of calls
      to the solver with illegal input, it will cause
      the run to stop.</li>
<li>-4  means there were repeated error test failures on
      one attempted step, before completing the requested
      task, but the integration was successful as far as t.
      the problem may have a singularity, or the input
      may be inappropriate.</li>
<li>-5  means there were repeated convergence test failures on
      one attempted step, before completing the requested
      task, but the integration was successful as far as t.
      this may be caused by an inaccurate jacobian matrix,
      if one is being used.</li>
<li>-6  means ewt(i) became zero for some i during the
      integration.  pure relative error control (atol(i)=0.0)
      was requested on a variable which has now vanished.
      the integration was successful as far as t.</li>
</ul>
<p>note:  since the normal output value of istate is 2,
it does not need to be reset for normal continuation.
also, since a negative input value of istate will be
regarded as illegal, a negative output value requires the
user to change it, and possibly other input, before
calling the solver again.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iopt"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iopt</strong></td>
            <td>
                <p>an integer flag to specify whether or not any optional
input is being used on this call.
the optional input is listed separately below.</p>
<ul>
<li>iopt = 0 means no optional input is being used.
   default values will be used in all cases.</li>
<li>iopt = 1 means optional input is being used.</li>
</ul>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rwork"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rwork</strong>(lrw)</td>
            <td>
                <p>a real working array.
the length of <code>rwork</code> must be at least
<code>20 + nyh*(maxord + 1) + 3*neq + lwm</code> where:</p>
<ul>
<li><code>nyh</code>    = the initial value of neq,</li>
<li><code>maxord</code> = 12 (if <code>meth</code> = 1) or 5 (if <code>meth</code> = 2) (unless a
              smaller value is given as an optional input),</li>
<li>
<p><code>lwm</code> = length of work space for matrix-related data:</p>
<ul>
<li><code>lwm = 0</code> if <code>miter</code> = 0,</li>
<li><code>lwm = 2*neq**2 + 2</code> if <code>miter</code> = 1 or 2, and <code>mf</code>&gt;0,</li>
<li><code>lwm = neq**2 + 2</code> if <code>miter</code> = 1 or 2, and <code>mf</code>&lt;0,</li>
<li><code>lwm = neq + 2</code> if <code>miter</code> = 3,</li>
<li><code>lwm = (3*ml+2*mu+2)*neq + 2</code> if <code>miter</code> = 4 or 5, and <code>mf</code>&gt;0,</li>
<li><code>lwm = (2*ml+mu+1)*neq + 2</code> if <code>miter</code> = 4 or 5, and <code>mf</code>&lt;0.</li>
</ul>
</li>
</ul>
<p>(see the <code>mf</code> description for <code>meth</code> and <code>miter</code>.)
thus if maxord has its default value and <code>neq</code> is constant,
this length is:</p>
<ul>
<li><code>20 + 16*neq</code>  for <code>mf</code> = 10,</li>
<li><code>22 + 16*neq + 2*neq**2</code>  for <code>mf</code> = 11 or 12,</li>
<li><code>22 + 16*neq + neq**2</code>  for <code>mf</code> = -11 or -12,</li>
<li><code>22 + 17*neq</code>  for <code>mf</code> = 13,</li>
<li><code>22 + 18*neq + (3*ml+2*mu)*neq</code>  for <code>mf</code> = 14 or 15,</li>
<li><code>22 + 17*neq + (2*ml+mu)*neq</code>  for <code>mf</code> = -14 or -15,</li>
<li><code>20 +  9*neq</code>  for <code>mf</code> = 20,</li>
<li><code>22 +  9*neq + 2*neq**2</code>  for <code>mf</code> = 21 or 22,</li>
<li><code>22 +  9*neq + neq**2</code>  for <code>mf</code> = -21 or -22,</li>
<li><code>22 + 10*neq</code>  for <code>mf</code> = 23,</li>
<li><code>22 + 11*neq + (3*ml+2*mu)*neq</code>  for <code>mf</code> = 24 or 25.</li>
<li><code>22 + 10*neq + (2*ml+mu)*neq</code>  for <code>mf</code> = -24 or -25.</li>
</ul>
<p>the first 20 words of <code>rwork</code> are reserved for conditional
and optional input and optional output.</p>
<p><code>rwork</code> can also used for conditional and
optional input and optional output.</p>
<p>the following word in <code>rwork</code> is a conditional input:</p>
<ul>
<li><code>rwork(1) = tcrit</code> = critical value of <code>t</code> which the solver
   is not to overshoot.  required if <code>itask</code> is
   4 or 5, and ignored otherwise.  (see <code>itask</code>.)</li>
</ul>
<p>The following optional input requires <code>iopt = 1</code>, and in that
case all of this input is examined.  a value of zero for any
of these optional input variables will cause the default value to be
used.  thus to use a subset of the optional input, simply preload
locations 5 to 10 in <code>rwork</code> to 0.0, and
then set those of interest to nonzero values:</p>
<ul>
<li>
<p><code>rwork(5) = h0</code> = the step size to be attempted on the first step.
   the default value is determined by the solver.</p>
</li>
<li>
<p><code>rwork(6) = hmax</code> = the maximum absolute step size allowed.
   the default value is infinite.</p>
</li>
<li>
<p><code>rwork(7) = hmin</code> = the minimum absolute step size allowed.
   the default value is 0.  (this lower bound is not
   enforced on the final step before reaching <code>tcrit</code>
   when <code>itask = 4 or 5</code>.)</p>
</li>
</ul>
<p>the following optional outputs
below are quantities related to the performance of <a href="../proc/dvode.html">dvode</a>
which are available to the user.
except where stated otherwise, all of this output is defined
on any successful return from <a href="../proc/dvode.html">dvode</a>, and on any return with
istate = -1, -2, -4, -5, or -6.  on an illegal input return
(istate = -3), they will be unchanged from their existing values
(if any), except possibly for <code>tolsf</code>.
on any error return, output relevant to the error will be defined,
as noted below:</p>
<ul>
<li>
<p><code>rwork(11) = hu</code> = the step size in t last used (successfully).</p>
</li>
<li>
<p><code>rwork(12) = hcur</code> = the step size to be attempted on the next step.</p>
</li>
<li>
<p><code>rwork(13) = tcur</code> = the current value of the independent variable
   which the solver has actually reached, i.e. the
   current internal mesh point in t.  in the output,
   tcur will always be at least as far from the
   initial value of t as the current argument t,
   but may be farther (if interpolation was done).</p>
</li>
<li>
<p><code>rwork(14) = tolsf</code> = a tolerance scale factor, greater than 1.0,
  computed when a request for too much accuracy was
  detected (istate = -3 if detected at the start of
  the problem, istate = -2 otherwise).  if itol is
  left unaltered but rtol and atol are uniformly
  scaled up by a factor of tolsf for the next call,
  then the solver is deemed likely to succeed.
  (the user may also ignore tolsf and alter the
  tolerance parameters in any other way appropriate.)</p>
</li>
</ul>
<p>the following two arrays are segments of the <code>rwork</code> array which
may also be of interest to the user as optional output:</p>
<ul>
<li>
<p><code>rwork(21:) = yh</code> = the nordsieck history array, of size <code>nyh</code> by
   <code>(nqcur + 1)</code>, where <code>nyh</code> is the initial value
   of <code>neq</code>.  for <code>j = 0,1,...,nqcur</code>, column <code>j+1</code>
   of <code>yh</code> contains <code>hcur**j/factorial(j)</code> times
   the <code>j-th</code> derivative of the interpolating
   polynomial currently representing the
   solution, evaluated at <code>t = tcur</code>.</p>
</li>
<li>
<p><code>rwork(lenrw-neq+1:) = acor</code> = <code>lenrw-neq+1</code> array
   of size <code>neq</code> used for the accumulated
   corrections on each step, scaled in the output
   to represent the estimated local error in <code>y</code>
   on the last step.  this is the vector <code>e</code> in
   the description of the error control.  it is
   defined only on a successful return from <a href="../proc/dvode.html">dvode</a>.</p>
</li>
</ul>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrw"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lrw</strong></td>
            <td>
                <p>the length of the array rwork, as declared by the user.
(this will be checked by the solver.)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwork"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iwork</strong>(liw)</td>
            <td>
                <p>an integer work array.  the length of iwork must be at least:</p>
<ul>
<li><code>30</code>        if miter = 0 or 3 (mf = 10, 13, 20, 23), or</li>
<li><code>30 + neq</code>  otherwise (abs(mf) = 11,12,14,15,21,22,24,25).</li>
</ul>
<p>the first 30 words of <code>iwork</code> are reserved for conditional and
optional input and optional output.</p>
<p>the following 2 words in <code>iwork</code> are conditional input:</p>
<ul>
<li><code>iwork(1) = ml</code></li>
<li><code>iwork(2) = mu</code></li>
</ul>
<p>these are the lower and upper
half-bandwidths, respectively, of the
banded jacobian, excluding the main diagonal.
the band is defined by the matrix locations
<code>(i,j)</code> with <code>i-ml &lt;= j &lt;= i+mu</code>.  <code>ml</code> and <code>mu</code>
must satisfy  <code>0 &lt;=  ml,mu  &lt;= neq-1</code>.
these are required if <code>miter</code> is 4 or 5, and
ignored otherwise.  <code>ml</code> and <code>mu</code> may in fact be
the band parameters for a matrix to which
<code>df/dy</code> is only approximately equal.</p>
<p>The following optional input requires <code>iopt = 1</code>, and in that
case all of this input is examined.  a value of zero for any
of these optional input variables will cause the default value to be
used.  thus to use a subset of the optional input, simply preload
locations 5 to 10 in <code>iwork</code> to 0, and
then set those of interest to nonzero values.</p>
<ul>
<li>
<p><code>iwork(5) = maxord</code> = the maximum order to be allowed.  the default
   value is 12 if <code>meth = 1</code>, and 5 if <code>meth = 2</code>.
   if <code>maxord</code> exceeds the default value, it will
   be reduced to the default value.
   if <code>maxord</code> is changed during the problem, it may
   cause the current order to be reduced.</p>
</li>
<li>
<p><code>iwork(6) = mxstep</code> = maximum number of (internally defined) steps
   allowed during one call to the solver.
   the default value is 500.</p>
</li>
<li>
<p><code>iwork(7) = mxhnil</code> = maximum number of messages printed (per problem)
   warning that <code>t + h = t</code> on a step (<code>h</code> = step size).
   this must be positive to result in a non-default
   value.  the default value is 10.</p>
</li>
</ul>
<p>as optional additional output from dvode, the variables listed
below are quantities related to the performance of dvode
which are available to the user.
except where stated otherwise, all of this output is defined
on any successful return from dvode, and on any return with
istate = -1, -2, -4, -5, or -6.  on an illegal input return
(istate = -3), they will be unchanged from their existing values
(if any), except possibly for <code>lenrw</code>, and <code>leniw</code>.
on any error return, output relevant to the error will be defined,
as noted below:</p>
<ul>
<li><code>iwork(11) = nst</code> = the number of steps taken for the problem so far.</li>
<li><code>iwork(12) = nfe</code> = the number of f evaluations for the problem so far.</li>
<li><code>iwork(13) = nje</code> = the number of jacobian evaluations so far.</li>
<li><code>iwork(14) = nqu</code> = the method order last used (successfully).</li>
<li><code>iwork(15) = nqcur</code> = the order to be attempted on the next step.</li>
<li><code>iwork(16) = imxer</code> = the index of the component of largest magnitude in
   the weighted local error vector ( e(i)/ewt(i) ),
   on an error return with istate = -4 or -5.</li>
<li><code>iwork(17) = lenrw</code> = the length of rwork actually required.
   this is defined on normal returns and on an illegal
   input return for insufficient storage.</li>
<li><code>iwork(18) = leniw</code> = the length of iwork actually required.
    this is defined on normal returns and on an illegal
    input return for insufficient storage.</li>
<li><code>iwork(19) = nlu</code> = the number of matrix lu decompositions so far.</li>
<li><code>iwork(20) = nni</code> = the number of nonlinear (newton) iterations so far.</li>
<li><code>iwork(21) = ncfn</code> = the number of convergence failures of the nonlinear
   solver so far.</li>
<li><code>iwork(22) = netf</code> = the number of error test failures of the integrator
   so far.</li>
</ul>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-liw"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>liw</strong></td>
            <td>
                <p>the length of the array iwork, as declared by the user.
(this will be checked by the solver.)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mf"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>mf</strong></td>
            <td>
                <p>method flag.  standard values are:</p>
<ul>
<li>10 for nonstiff (adams) method, no jacobian used.</li>
<li>21 for stiff (bdf) method, user-supplied full jacobian.</li>
<li>22 for stiff method, internally generated full jacobian.</li>
<li>24 for stiff method, user-supplied banded jacobian.</li>
<li>25 for stiff method, internally generated banded jacobian.</li>
</ul>
<p>the complete set of legal values of
mf are 10, 11, 12, 13, 14, 15, 20, 21, 22, 23, 24, 25,
-11, -12, -14, -15, -21, -22, -24, -25.</p>
<p><code>mf</code> is a signed two-digit integer, <code>mf = jsv*(10*meth + miter)</code></p>
<p><code>jsv = sign(mf)</code> indicates the jacobian-saving strategy:</p>
<ul>
<li>jsv =  1 means a copy of the jacobian is saved for reuse
          in the corrector iteration algorithm.</li>
<li>jsv = -1 means a copy of the jacobian is not saved
         (valid only for miter = 1, 2, 4, or 5).</li>
</ul>
<p><code>meth</code> indicates the basic linear multistep method:</p>
<ul>
<li>meth = 1 means the implicit adams method.</li>
<li>meth = 2 means the method based on backward
          differentiation formulas (bdf-s).</li>
</ul>
<p><code>miter</code> indicates the corrector iteration method:</p>
<ul>
<li>miter = 0 means functional iteration (no jacobian matrix
   is involved).</li>
<li>miter = 1 means chord iteration with a user-supplied
   full (neq by neq) jacobian.</li>
<li>miter = 2 means chord iteration with an internally
   generated (difference quotient) full jacobian
   (using neq extra calls to f per df/dy value).</li>
<li>miter = 3 means chord iteration with an internally
   generated diagonal jacobian approximation
   (using 1 extra call to f per df/dy evaluation).</li>
<li>miter = 4 means chord iteration with a user-supplied
   banded jacobian.</li>
<li>miter = 5 means chord iteration with an internally
   generated banded jacobian (using ml+mu+1 extra
   calls to f per df/dy evaluation).</li>
</ul>
<p>if miter = 1 or 4, the user must supply a subroutine <code>jac</code>
(the name is arbitrary) as described above under <code>jac</code>.
for other values of miter, a dummy argument can be used.</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~dvode~~CallsGraph Pages: 1 -->
<svg id="procdvodeCallsGraph" width="641pt" height="630pt"
 viewBox="0.00 0.00 641.00 629.85" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~dvode~~CallsGraph" class="graph" transform="scale(0.93 0.93) rotate(0) translate(4 674)">
<title>proc~~dvode~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-674 686,-674 686,4 -4,4"/>
<!-- proc~dvode -->
<g id="proc~~dvode~~CallsGraph_node1" class="node">
<title>proc~dvode</title>
<polygon fill="none" stroke="black" points="97,-582 0,-582 0,-558 97,-558 97,-582"/>
<text text-anchor="middle" x="48.5" y="-567.6" font-family="Helvetica,sans-Serif" font-size="10.50">dvode_t%dvode</text>
</g>
<!-- proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_node2" class="node">
<title>proc~dcopy</title>
<g id="a_proc~~dvode~~CallsGraph_node2"><a xlink:href="../proc/dcopy.html" xlink:title="dcopy">
<polygon fill="#d9534f" stroke="#d9534f" points="682,-88 628,-88 628,-64 682,-64 682,-88"/>
<text text-anchor="middle" x="655" y="-73.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dcopy</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_edge1" class="edge">
<title>proc~dvode&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M49.45,-557.83C49.77,-475.22 62.72,0 318.5,0 318.5,0 318.5,0 455,0 520.29,0 590.17,-36.14 627.25,-58.58"/>
<polygon fill="#000000" stroke="#000000" points="625.61,-61.68 635.96,-63.96 629.29,-55.72 625.61,-61.68"/>
</g>
<!-- proc~dscal -->
<g id="proc~~dvode~~CallsGraph_node3" class="node">
<title>proc~dscal</title>
<g id="a_proc~~dvode~~CallsGraph_node3"><a xlink:href="../proc/dscal.html" xlink:title="dscal">
<polygon fill="#d9534f" stroke="#d9534f" points="682,-526 628,-526 628,-502 682,-502 682,-526"/>
<text text-anchor="middle" x="655" y="-511.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dscal</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge2" class="edge">
<title>proc~dvode&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M61.58,-582.24C76.83,-596.93 104.52,-621.18 133,-634 209.59,-668.46 234.52,-670 318.5,-670 318.5,-670 318.5,-670 455,-670 541.7,-670 613.07,-577.14 641.16,-534.71"/>
<polygon fill="#000000" stroke="#000000" points="644.15,-536.54 646.63,-526.24 638.27,-532.74 644.15,-536.54"/>
</g>
<!-- proc~dvhin -->
<g id="proc~~dvode~~CallsGraph_node4" class="node">
<title>proc~dvhin</title>
<g id="a_proc~~dvode~~CallsGraph_node4"><a xlink:href="../proc/dvhin.html" xlink:title="dvode_t%dvhin">
<polygon fill="#d9534f" stroke="#d9534f" points="230,-603 136,-603 136,-579 230,-579 230,-603"/>
<text text-anchor="middle" x="183" y="-588.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvhin</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dvhin -->
<g id="proc~~dvode~~CallsGraph_edge3" class="edge">
<title>proc~dvode&#45;&gt;proc~dvhin</title>
<path fill="none" stroke="#000000" d="M97.34,-577.58C106.48,-579.03 116.13,-580.56 125.52,-582.05"/>
<polygon fill="#000000" stroke="#000000" points="125.14,-585.53 135.56,-583.64 126.24,-578.62 125.14,-585.53"/>
</g>
<!-- proc~dvindy -->
<g id="proc~~dvode~~CallsGraph_node5" class="node">
<title>proc~dvindy</title>
<g id="a_proc~~dvode~~CallsGraph_node5"><a xlink:href="../proc/dvindy.html" xlink:title="dvode_t%dvindy">
<polygon fill="#d9534f" stroke="#d9534f" points="233,-561 133,-561 133,-537 233,-537 233,-561"/>
<text text-anchor="middle" x="183" y="-546.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvindy</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dvindy -->
<g id="proc~~dvode~~CallsGraph_edge4" class="edge">
<title>proc~dvode&#45;&gt;proc~dvindy</title>
<path fill="none" stroke="#000000" d="M97.34,-562.42C105.65,-561.1 114.38,-559.72 122.95,-558.36"/>
<polygon fill="#000000" stroke="#000000" points="123.57,-561.8 132.9,-556.78 122.47,-554.89 123.57,-561.8"/>
</g>
<!-- proc~dvstep -->
<g id="proc~~dvode~~CallsGraph_node6" class="node">
<title>proc~dvstep</title>
<g id="a_proc~~dvode~~CallsGraph_node6"><a xlink:href="../proc/dvstep.html" xlink:title="dvode_t%dvstep">
<polygon fill="#d9534f" stroke="#d9534f" points="233,-331 133,-331 133,-307 233,-307 233,-331"/>
<text text-anchor="middle" x="183" y="-316.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvstep</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dvstep -->
<g id="proc~~dvode~~CallsGraph_edge5" class="edge">
<title>proc~dvode&#45;&gt;proc~dvstep</title>
<path fill="none" stroke="#000000" d="M55.89,-557.89C76.88,-518.14 143.86,-391.25 170.71,-340.39"/>
<polygon fill="#000000" stroke="#000000" points="173.94,-341.76 175.52,-331.28 167.75,-338.49 173.94,-341.76"/>
</g>
<!-- proc~xerrwd -->
<g id="proc~~dvode~~CallsGraph_node7" class="node">
<title>proc~xerrwd</title>
<g id="a_proc~~dvode~~CallsGraph_node7"><a xlink:href="../proc/xerrwd.html" xlink:title="dvode_t%xerrwd">
<polygon fill="#d9534f" stroke="#d9534f" points="370,-642 269,-642 269,-618 370,-618 370,-642"/>
<text text-anchor="middle" x="319.5" y="-627.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%xerrwd</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~xerrwd -->
<g id="proc~~dvode~~CallsGraph_edge6" class="edge">
<title>proc~dvode&#45;&gt;proc~xerrwd</title>
<path fill="none" stroke="#000000" d="M68.57,-582.16C84.97,-591.98 109.62,-605.24 133,-612 173.91,-623.83 221.79,-628.25 258.66,-629.76"/>
<polygon fill="#000000" stroke="#000000" points="258.64,-633.26 268.75,-630.11 258.88,-626.26 258.64,-633.26"/>
</g>
<!-- proc~dvindy&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge7" class="edge">
<title>proc~dvindy&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M226.43,-561.07C302.42,-580.47 465.58,-612 592,-566 609.76,-559.54 625.98,-545.51 637.37,-533.65"/>
<polygon fill="#000000" stroke="#000000" points="639.95,-536.01 644.12,-526.27 634.79,-531.28 639.95,-536.01"/>
</g>
<!-- proc~dvindy&#45;&gt;proc~xerrwd -->
<g id="proc~~dvode~~CallsGraph_edge8" class="edge">
<title>proc~dvindy&#45;&gt;proc~xerrwd</title>
<path fill="none" stroke="#000000" d="M216.73,-561.11C222.34,-563.72 227.97,-566.7 233,-570 251.4,-582.08 251.09,-591.21 269,-604 273.49,-607.21 278.43,-610.28 283.4,-613.1"/>
<polygon fill="#000000" stroke="#000000" points="281.82,-616.23 292.28,-617.92 285.15,-610.07 281.82,-616.23"/>
</g>
<!-- proc~dvstep&#45;&gt;proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_edge10" class="edge">
<title>proc~dvstep&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M192.41,-306.75C218.79,-269.4 304.28,-156.58 406,-108 475.49,-74.82 567.75,-72.25 617.86,-73.81"/>
<polygon fill="#000000" stroke="#000000" points="617.76,-77.31 627.89,-74.2 618.03,-70.32 617.76,-77.31"/>
</g>
<!-- proc~dvstep&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge11" class="edge">
<title>proc~dvstep&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M190.73,-331.3C203.73,-354.3 234.08,-404.6 269,-439 321.6,-490.82 335.47,-511.13 406,-533 478.78,-555.57 569.05,-538 618.12,-524.9"/>
<polygon fill="#000000" stroke="#000000" points="619.24,-528.22 627.95,-522.19 617.38,-521.48 619.24,-528.22"/>
</g>
<!-- proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_node8" class="node">
<title>proc~daxpy</title>
<g id="a_proc~~dvode~~CallsGraph_node8"><a xlink:href="../proc/daxpy.html" xlink:title="daxpy">
<polygon fill="#d9534f" stroke="#d9534f" points="682,-328 628,-328 628,-304 682,-304 682,-328"/>
<text text-anchor="middle" x="655" y="-313.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">daxpy</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge9" class="edge">
<title>proc~dvstep&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M233.41,-318.68C328.35,-318.08 534.26,-316.76 617.75,-316.23"/>
<polygon fill="#000000" stroke="#000000" points="618.02,-319.73 628,-316.17 617.98,-312.73 618.02,-319.73"/>
</g>
<!-- proc~dvjust -->
<g id="proc~~dvode~~CallsGraph_node9" class="node">
<title>proc~dvjust</title>
<g id="a_proc~~dvode~~CallsGraph_node9"><a xlink:href="../proc/dvjust.html" xlink:title="dvode_t%dvjust">
<polygon fill="#d9534f" stroke="#d9534f" points="502,-524 406,-524 406,-500 502,-500 502,-524"/>
<text text-anchor="middle" x="454" y="-509.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvjust</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvjust -->
<g id="proc~~dvode~~CallsGraph_edge12" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvjust</title>
<path fill="none" stroke="#000000" d="M198.55,-331.08C233.29,-359.67 324.25,-433.01 406,-486 410.69,-489.04 415.77,-492.09 420.79,-494.97"/>
<polygon fill="#000000" stroke="#000000" points="419.24,-498.11 429.67,-499.93 422.65,-492 419.24,-498.11"/>
</g>
<!-- proc~dvnlsd -->
<g id="proc~~dvode~~CallsGraph_node10" class="node">
<title>proc~dvnlsd</title>
<g id="a_proc~~dvode~~CallsGraph_node10"><a xlink:href="../proc/dvnlsd.html" xlink:title="dvode_t%dvnlsd">
<polygon fill="#d9534f" stroke="#d9534f" points="369,-249 270,-249 270,-225 369,-225 369,-249"/>
<text text-anchor="middle" x="319.5" y="-234.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvnlsd</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvnlsd -->
<g id="proc~~dvode~~CallsGraph_edge13" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvnlsd</title>
<path fill="none" stroke="#000000" d="M198.68,-306.92C215.11,-293.78 242.87,-272.68 269,-258 271.85,-256.4 274.84,-254.84 277.89,-253.35"/>
<polygon fill="#000000" stroke="#000000" points="279.5,-256.46 287.1,-249.08 276.56,-250.11 279.5,-256.46"/>
</g>
<!-- proc~dvset -->
<g id="proc~~dvode~~CallsGraph_node11" class="node">
<title>proc~dvset</title>
<g id="a_proc~~dvode~~CallsGraph_node11"><a xlink:href="../proc/dvset.html" xlink:title="dvode_t%dvset">
<polygon fill="#d9534f" stroke="#d9534f" points="366,-291 273,-291 273,-267 366,-267 366,-291"/>
<text text-anchor="middle" x="319.5" y="-276.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvset</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvset -->
<g id="proc~~dvode~~CallsGraph_edge14" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvset</title>
<path fill="none" stroke="#000000" d="M224.35,-307C238.06,-302.92 253.55,-298.32 267.95,-294.03"/>
<polygon fill="#000000" stroke="#000000" points="269.12,-297.34 277.71,-291.13 267.13,-290.63 269.12,-297.34"/>
</g>
<!-- proc~ixsav -->
<g id="proc~~dvode~~CallsGraph_node12" class="node">
<title>proc~ixsav</title>
<g id="a_proc~~dvode~~CallsGraph_node12"><a xlink:href="../proc/ixsav.html" xlink:title="dvode_t%ixsav">
<polygon fill="#d94e8f" stroke="#d94e8f" points="499.5,-642 408.5,-642 408.5,-618 499.5,-618 499.5,-642"/>
<text text-anchor="middle" x="454" y="-627.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%ixsav</text>
</a>
</g>
</g>
<!-- proc~xerrwd&#45;&gt;proc~ixsav -->
<g id="proc~~dvode~~CallsGraph_edge15" class="edge">
<title>proc~xerrwd&#45;&gt;proc~ixsav</title>
<path fill="none" stroke="#000000" d="M370.22,-630C379.29,-630 388.8,-630 398.01,-630"/>
<polygon fill="#000000" stroke="#000000" points="398.24,-633.5 408.24,-630 398.24,-626.5 398.24,-633.5"/>
</g>
<!-- proc~dvjust&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge16" class="edge">
<title>proc~dvjust&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M459.55,-499.64C469.81,-473.24 497.08,-410.71 538,-373 561.06,-351.75 593.51,-336.71 618.23,-327.44"/>
<polygon fill="#000000" stroke="#000000" points="619.74,-330.62 627.96,-323.94 617.36,-324.03 619.74,-330.62"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_edge18" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M334.6,-224.7C367.61,-196.64 453.5,-127.81 538,-95 563.57,-85.07 594.27,-80.33 617.66,-78.07"/>
<polygon fill="#000000" stroke="#000000" points="618.18,-81.54 627.85,-77.19 617.59,-74.56 618.18,-81.54"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge19" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M359.15,-249.05C363.2,-251.51 366.95,-254.47 370,-258 411.43,-305.97 369.49,-344.18 406,-396 456.44,-467.59 562.15,-497.19 617.87,-508.21"/>
<polygon fill="#000000" stroke="#000000" points="617.51,-511.7 627.99,-510.11 618.81,-504.82 617.51,-511.7"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge17" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M369.31,-249.09C381.3,-252.03 394.11,-255.15 406,-258 481.31,-276.05 569.66,-296.55 617.95,-307.7"/>
<polygon fill="#000000" stroke="#000000" points="617.38,-311.16 627.91,-310 618.96,-304.34 617.38,-311.16"/>
</g>
<!-- proc~dvjac -->
<g id="proc~~dvode~~CallsGraph_node13" class="node">
<title>proc~dvjac</title>
<g id="a_proc~~dvode~~CallsGraph_node13"><a xlink:href="../proc/dvjac.html" xlink:title="dvode_t%dvjac">
<polygon fill="#d9534f" stroke="#d9534f" points="500.5,-387 407.5,-387 407.5,-363 500.5,-363 500.5,-387"/>
<text text-anchor="middle" x="454" y="-372.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvjac</text>
</a>
</g>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dvjac -->
<g id="proc~~dvode~~CallsGraph_edge20" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dvjac</title>
<path fill="none" stroke="#000000" d="M355.7,-249.03C360.77,-251.57 365.71,-254.55 370,-258 403.21,-284.72 429.11,-328 442.63,-353.76"/>
<polygon fill="#000000" stroke="#000000" points="439.53,-355.39 447.2,-362.7 445.77,-352.21 439.53,-355.39"/>
</g>
<!-- proc~dvsol -->
<g id="proc~~dvode~~CallsGraph_node14" class="node">
<title>proc~dvsol</title>
<g id="a_proc~~dvode~~CallsGraph_node14"><a xlink:href="../proc/dvsol.html" xlink:title="dvode_t%dvsol">
<polygon fill="#d9534f" stroke="#d9534f" points="500,-249 408,-249 408,-225 500,-225 500,-249"/>
<text text-anchor="middle" x="454" y="-234.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvsol</text>
</a>
</g>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dvsol -->
<g id="proc~~dvode~~CallsGraph_edge21" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dvsol</title>
<path fill="none" stroke="#000000" d="M369.09,-237C378.41,-237 388.25,-237 397.77,-237"/>
<polygon fill="#000000" stroke="#000000" points="397.94,-240.5 407.94,-237 397.94,-233.5 397.94,-240.5"/>
</g>
<!-- proc~dvjac&#45;&gt;proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_edge23" class="edge">
<title>proc~dvjac&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M459.86,-362.75C476.67,-320.49 531.64,-182.94 538,-175 556.35,-152.1 569.46,-155.8 592,-137 607.41,-124.15 623.53,-108.2 635.47,-95.83"/>
<polygon fill="#000000" stroke="#000000" points="638.29,-97.95 642.66,-88.3 633.22,-93.12 638.29,-97.95"/>
</g>
<!-- proc~dvjac&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge26" class="edge">
<title>proc~dvjac&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M464.99,-387.09C479.64,-404.27 508.45,-435.99 538,-457 563.07,-474.83 594.56,-489.91 618.41,-500.07"/>
<polygon fill="#000000" stroke="#000000" points="617.21,-503.37 627.79,-503.99 619.91,-496.91 617.21,-503.37"/>
</g>
<!-- proc~dacopy -->
<g id="proc~~dvode~~CallsGraph_node15" class="node">
<title>proc~dacopy</title>
<g id="a_proc~~dvode~~CallsGraph_node15"><a xlink:href="../proc/dacopy.html" xlink:title="dacopy">
<polygon fill="#d9534f" stroke="#d9534f" points="592,-128 538,-128 538,-104 592,-104 592,-128"/>
<text text-anchor="middle" x="565" y="-113.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dacopy</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dacopy -->
<g id="proc~~dvode~~CallsGraph_edge22" class="edge">
<title>proc~dvjac&#45;&gt;proc~dacopy</title>
<path fill="none" stroke="#000000" d="M460.27,-362.83C469.33,-341.7 488.22,-296.78 502,-258 520.08,-207.14 510.1,-188.21 538,-142 539.33,-139.8 540.88,-137.65 542.56,-135.59"/>
<polygon fill="#000000" stroke="#000000" points="545.2,-137.88 549.4,-128.15 540.05,-133.14 545.2,-137.88"/>
</g>
<!-- proc~dgbfa -->
<g id="proc~~dvode~~CallsGraph_node16" class="node">
<title>proc~dgbfa</title>
<g id="a_proc~~dvode~~CallsGraph_node16"><a xlink:href="../proc/dgbfa.html" xlink:title="dgbfa">
<polygon fill="#d9534f" stroke="#d9534f" points="592,-448 538,-448 538,-424 592,-424 592,-448"/>
<text text-anchor="middle" x="565" y="-433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgbfa</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dgbfa -->
<g id="proc~~dvode~~CallsGraph_edge24" class="edge">
<title>proc~dvjac&#45;&gt;proc~dgbfa</title>
<path fill="none" stroke="#000000" d="M476.53,-387.05C492.81,-396.16 515.36,-408.78 533.49,-418.93"/>
<polygon fill="#000000" stroke="#000000" points="532.07,-422.14 542.51,-423.97 535.49,-416.04 532.07,-422.14"/>
</g>
<!-- proc~dgefa -->
<g id="proc~~dvode~~CallsGraph_node18" class="node">
<title>proc~dgefa</title>
<g id="a_proc~~dvode~~CallsGraph_node18"><a xlink:href="../proc/dgefa.html" xlink:title="dgefa">
<polygon fill="#d9534f" stroke="#d9534f" points="592,-406 538,-406 538,-382 592,-382 592,-406"/>
<text text-anchor="middle" x="565" y="-391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgefa</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dgefa -->
<g id="proc~~dvode~~CallsGraph_edge25" class="edge">
<title>proc~dvjac&#45;&gt;proc~dgefa</title>
<path fill="none" stroke="#000000" d="M500.59,-382.95C509.74,-384.54 519.22,-386.19 527.98,-387.72"/>
<polygon fill="#000000" stroke="#000000" points="527.42,-391.18 537.87,-389.45 528.62,-384.28 527.42,-391.18"/>
</g>
<!-- proc~dgbsl -->
<g id="proc~~dvode~~CallsGraph_node17" class="node">
<title>proc~dgbsl</title>
<g id="a_proc~~dvode~~CallsGraph_node17"><a xlink:href="../proc/dgbsl.html" xlink:title="dgbsl">
<polygon fill="#d9534f" stroke="#d9534f" points="592,-208 538,-208 538,-184 592,-184 592,-208"/>
<text text-anchor="middle" x="565" y="-193.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgbsl</text>
</a>
</g>
</g>
<!-- proc~dvsol&#45;&gt;proc~dgbsl -->
<g id="proc~~dvode~~CallsGraph_edge27" class="edge">
<title>proc~dvsol&#45;&gt;proc~dgbsl</title>
<path fill="none" stroke="#000000" d="M487.11,-224.92C500.02,-220.06 514.96,-214.44 528.22,-209.46"/>
<polygon fill="#000000" stroke="#000000" points="529.84,-212.59 537.97,-205.79 527.38,-206.04 529.84,-212.59"/>
</g>
<!-- proc~dgesl -->
<g id="proc~~dvode~~CallsGraph_node19" class="node">
<title>proc~dgesl</title>
<g id="a_proc~~dvode~~CallsGraph_node19"><a xlink:href="../proc/dgesl.html" xlink:title="dgesl">
<polygon fill="#d9534f" stroke="#d9534f" points="592,-250 538,-250 538,-226 592,-226 592,-250"/>
<text text-anchor="middle" x="565" y="-235.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgesl</text>
</a>
</g>
</g>
<!-- proc~dvsol&#45;&gt;proc~dgesl -->
<g id="proc~~dvode~~CallsGraph_edge28" class="edge">
<title>proc~dvsol&#45;&gt;proc~dgesl</title>
<path fill="none" stroke="#000000" d="M500.28,-237.42C509.34,-237.5 518.76,-237.58 527.48,-237.66"/>
<polygon fill="#000000" stroke="#000000" points="527.68,-241.17 537.71,-237.76 527.74,-234.17 527.68,-241.17"/>
</g>
<!-- proc~dacopy&#45;&gt;proc~dcopy -->
<g id="proc~~dvode~~CallsGraph_edge29" class="edge">
<title>proc~dacopy&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M592.4,-104C600.66,-100.25 609.9,-96.05 618.66,-92.06"/>
<polygon fill="#000000" stroke="#000000" points="620.26,-95.18 627.92,-87.86 617.37,-88.81 620.26,-95.18"/>
</g>
<!-- proc~dgbfa&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge31" class="edge">
<title>proc~dgbfa&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M579.75,-448.19C593.96,-460.78 616.32,-480.6 632.79,-495.2"/>
<polygon fill="#000000" stroke="#000000" points="630.54,-497.88 640.35,-501.9 635.18,-492.65 630.54,-497.88"/>
</g>
<!-- proc~dgbfa&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge30" class="edge">
<title>proc~dgbfa&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M582.69,-423.89C585.96,-421.15 589.23,-418.13 592,-415 613.49,-390.77 632.3,-358.24 643.4,-337.2"/>
<polygon fill="#000000" stroke="#000000" points="646.6,-338.63 648.08,-328.14 640.38,-335.42 646.6,-338.63"/>
</g>
<!-- proc~idamax -->
<g id="proc~~dvode~~CallsGraph_node21" class="node">
<title>proc~idamax</title>
<g id="a_proc~~dvode~~CallsGraph_node21"><a xlink:href="../proc/idamax.html" xlink:title="idamax">
<polygon fill="#d94e8f" stroke="#d94e8f" points="682,-427 628,-427 628,-403 682,-403 682,-427"/>
<text text-anchor="middle" x="655" y="-412.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">idamax</text>
</a>
</g>
</g>
<!-- proc~dgbfa&#45;&gt;proc~idamax -->
<g id="proc~~dvode~~CallsGraph_edge32" class="edge">
<title>proc~dgbfa&#45;&gt;proc~idamax</title>
<path fill="none" stroke="#000000" d="M592.4,-429.7C600.48,-427.77 609.51,-425.62 618.1,-423.57"/>
<polygon fill="#000000" stroke="#000000" points="619,-426.95 627.92,-421.22 617.38,-420.14 619,-426.95"/>
</g>
<!-- proc~dgbsl&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge33" class="edge">
<title>proc~dgbsl&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M582.69,-208.11C585.96,-210.85 589.23,-213.87 592,-217 613.49,-241.23 632.3,-273.76 643.4,-294.8"/>
<polygon fill="#000000" stroke="#000000" points="640.38,-296.58 648.08,-303.86 646.6,-293.37 640.38,-296.58"/>
</g>
<!-- proc~ddot -->
<g id="proc~~dvode~~CallsGraph_node20" class="node">
<title>proc~ddot</title>
<g id="a_proc~~dvode~~CallsGraph_node20"><a xlink:href="../proc/ddot.html" xlink:title="ddot">
<polygon fill="#d94e8f" stroke="#d94e8f" points="682,-229 628,-229 628,-205 682,-205 682,-229"/>
<text text-anchor="middle" x="655" y="-214.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddot</text>
</a>
</g>
</g>
<!-- proc~dgbsl&#45;&gt;proc~ddot -->
<g id="proc~~dvode~~CallsGraph_edge34" class="edge">
<title>proc~dgbsl&#45;&gt;proc~ddot</title>
<path fill="none" stroke="#000000" d="M592.4,-202.3C600.48,-204.23 609.51,-206.38 618.1,-208.43"/>
<polygon fill="#000000" stroke="#000000" points="617.38,-211.86 627.92,-210.78 619,-205.05 617.38,-211.86"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~dscal -->
<g id="proc~~dvode~~CallsGraph_edge36" class="edge">
<title>proc~dgefa&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M582.69,-406.11C585.96,-408.85 589.23,-411.87 592,-415 613.49,-439.23 632.3,-471.76 643.4,-492.8"/>
<polygon fill="#000000" stroke="#000000" points="640.38,-494.58 648.08,-501.86 646.6,-491.37 640.38,-494.58"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge35" class="edge">
<title>proc~dgefa&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M579.75,-381.81C593.96,-369.22 616.32,-349.4 632.79,-334.8"/>
<polygon fill="#000000" stroke="#000000" points="635.18,-337.35 640.35,-328.1 630.54,-332.12 635.18,-337.35"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~idamax -->
<g id="proc~~dvode~~CallsGraph_edge37" class="edge">
<title>proc~dgefa&#45;&gt;proc~idamax</title>
<path fill="none" stroke="#000000" d="M592.4,-400.3C600.48,-402.23 609.51,-404.38 618.1,-406.43"/>
<polygon fill="#000000" stroke="#000000" points="617.38,-409.86 627.92,-408.78 619,-403.05 617.38,-409.86"/>
</g>
<!-- proc~dgesl&#45;&gt;proc~daxpy -->
<g id="proc~~dvode~~CallsGraph_edge38" class="edge">
<title>proc~dgesl&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M579.75,-250.19C593.96,-262.78 616.32,-282.6 632.79,-297.2"/>
<polygon fill="#000000" stroke="#000000" points="630.54,-299.88 640.35,-303.9 635.18,-294.65 630.54,-299.88"/>
</g>
<!-- proc~dgesl&#45;&gt;proc~ddot -->
<g id="proc~~dvode~~CallsGraph_edge39" class="edge">
<title>proc~dgesl&#45;&gt;proc~ddot</title>
<path fill="none" stroke="#000000" d="M592.4,-231.7C600.48,-229.77 609.51,-227.62 618.1,-225.57"/>
<polygon fill="#000000" stroke="#000000" points="619,-228.95 627.92,-223.22 617.38,-222.14 619,-228.95"/>
</g>
</g>
</svg>
</div>                <script>
                  var panprocdvodeCallsGraph = svgPanZoom('#procdvodeCallsGraph',
                    {zoomEnabled: true, controlIconsEnabled: true, fit: true, center: true,}
                  );
                </script>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">   </span><span class="k">subroutine </span><span class="n">dvode</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">neq</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">itol</span><span class="p">,</span><span class="n">rtol</span><span class="p">,</span><span class="n">atol</span><span class="p">,</span><span class="n">itask</span><span class="p">,</span><span class="n">istate</span><span class="p">,</span><span class="n">iopt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">rwork</span><span class="p">,</span><span class="n">lrw</span><span class="p">,</span><span class="n">iwork</span><span class="p">,</span><span class="n">liw</span><span class="p">,</span><span class="n">mf</span><span class="p">)</span>

<span class="w">      </span><span class="k">class</span><span class="p">(</span><span class="n">dvode_t</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! a real array for the vector of dependent variables, of</span>
<span class="w">                                     </span><span class="c">!! length `neq` or more.  used for both input and output on the</span>
<span class="w">                                     </span><span class="c">!! first call (`istate = 1`), and only for output on other calls.</span>
<span class="w">                                     </span><span class="c">!! on the first call, `y` must contain the vector of initial</span>
<span class="w">                                     </span><span class="c">!! values.  in the output, `y` contains the computed solution</span>
<span class="w">                                     </span><span class="c">!! evaluated at `t`.  if desired, the `y` array may be used</span>
<span class="w">                                     </span><span class="c">!! for other purposes between calls to the solver.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! this array is passed as the `y` argument in all calls to</span>
<span class="w">                                     </span><span class="c">!! `f` and `jac`.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="c">!! the independent variable.  in the input, `t` is used only on</span>
<span class="w">                                  </span><span class="c">!! the first call, as the initial point of the integration.</span>
<span class="w">                                  </span><span class="c">!! in the output, after each call, `t` is the value at which a</span>
<span class="w">                                  </span><span class="c">!! computed solution `y` is evaluated (usually the same as `tout`).</span>
<span class="w">                                  </span><span class="c">!! on an error return, `t` is the farthest point reached.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tout</span><span class="w"> </span><span class="c">!! the next value of `t` at which a computed solution is desired.</span>
<span class="w">                                  </span><span class="c">!!</span>
<span class="w">                                  </span><span class="c">!! when starting the problem (`istate = 1`), `tout` may be equal</span>
<span class="w">                                  </span><span class="c">!! to `t` for one call, then should `/= t` for the next call.</span>
<span class="w">                                  </span><span class="c">!! for the initial `t`, an input value of `tout /= t` is used</span>
<span class="w">                                  </span><span class="c">!! in order to determine the direction of the integration</span>
<span class="w">                                  </span><span class="c">!! (i.e. the algebraic sign of the step sizes) and the rough</span>
<span class="w">                                  </span><span class="c">!! scale of the problem.  integration in either direction</span>
<span class="w">                                  </span><span class="c">!! (forward or backward in `t`) is permitted.</span>
<span class="w">                                  </span><span class="c">!!</span>
<span class="w">                                  </span><span class="c">!! if `itask = 2 or 5` (one-step modes), `tout` is ignored after</span>
<span class="w">                                  </span><span class="c">!! the first call (i.e. the first call with `tout /= t`).</span>
<span class="w">                                  </span><span class="c">!! otherwise, `tout` is required on every call.</span>
<span class="w">                                  </span><span class="c">!!</span>
<span class="w">                                  </span><span class="c">!! if `itask = 1, 3, or 4`, the values of `tout` need not be</span>
<span class="w">                                  </span><span class="c">!! monotone, but a value of `tout` which backs up is limited</span>
<span class="w">                                  </span><span class="c">!! to the current internal `t` interval, whose endpoints are</span>
<span class="w">                                  </span><span class="c">!! `tcur - hu` and `tcur`.  (see optional output, below, for</span>
<span class="w">                                  </span><span class="c">!! `tcur` and `hu`.)</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rtol</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! a relative error tolerance parameter, either a scalar or</span>
<span class="w">                                     </span><span class="c">!! an array of length `neq`.  see description under `atol`.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">atol</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! an absolute error tolerance parameter, either a scalar or</span>
<span class="w">                                     </span><span class="c">!! an array of length `neq`.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! the input parameters `itol`, `rtol`, and `atol` determine</span>
<span class="w">                                     </span><span class="c">!! the error control performed by the solver.  the solver will</span>
<span class="w">                                     </span><span class="c">!! control the vector `e = (e(i))` of estimated local errors</span>
<span class="w">                                     </span><span class="c">!! in `y`, according to an inequality of the form</span>
<span class="w">                                     </span><span class="c">!!```</span>
<span class="w">                                     </span><span class="c">!!        rms-norm of ( e(i)/ewt(i) )   &lt;=   1,</span>
<span class="w">                                     </span><span class="c">!! where  ewt(i) = rtol(i)*abs(y(i)) + atol(i),</span>
<span class="w">                                     </span><span class="c">!!```</span>
<span class="w">                                     </span><span class="c">!! and the rms-norm (root-mean-square norm) here is</span>
<span class="w">                                     </span><span class="c">!! `rms-norm(v) = sqrt(sum v(i)**2 / neq)`.  here `ewt = (ewt(i))`</span>
<span class="w">                                     </span><span class="c">!! is a vector of weights which must always be positive, and</span>
<span class="w">                                     </span><span class="c">!! the values of `rtol` and `atol` should all be non-negative.</span>
<span class="w">                                     </span><span class="c">!! the following table gives the types (scalar/array) of</span>
<span class="w">                                     </span><span class="c">!! `rtol` and `atol`, and the corresponding form of `ewt(i)`.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!!```</span>
<span class="w">                                     </span><span class="c">!!    itol    rtol       atol          ewt(i)</span>
<span class="w">                                     </span><span class="c">!!     1     scalar     scalar     rtol*abs(y(i)) + atol</span>
<span class="w">                                     </span><span class="c">!!     2     scalar     array      rtol*abs(y(i)) + atol(i)</span>
<span class="w">                                     </span><span class="c">!!     3     array      scalar     rtol(i)*abs(y(i)) + atol</span>
<span class="w">                                     </span><span class="c">!!     4     array      array      rtol(i)*abs(y(i)) + atol(i)</span>
<span class="w">                                     </span><span class="c">!!```</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! when either of these parameters is a scalar, it need not</span>
<span class="w">                                     </span><span class="c">!! be dimensioned in the user&#39;s calling program.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! if none of the above choices (with `itol`, `rtol`, and `atol`</span>
<span class="w">                                     </span><span class="c">!! fixed throughout the problem) is suitable, more general</span>
<span class="w">                                     </span><span class="c">!! error controls can be obtained by substituting</span>
<span class="w">                                     </span><span class="c">!! user-supplied routines for the setting of `ewt` and/or for</span>
<span class="w">                                     </span><span class="c">!! the norm calculation.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! if global errors are to be estimated by making a repeated</span>
<span class="w">                                     </span><span class="c">!! run on the same problem with smaller tolerances, then all</span>
<span class="w">                                     </span><span class="c">!! components of `rtol` and `atol` (i.e. of `ewt`) should be scaled</span>
<span class="w">                                     </span><span class="c">!! down uniformly.</span>
<span class="w">                                     </span><span class="c">!!</span>
<span class="w">                                     </span><span class="c">!! use `rtol = 0.0` for pure absolute error control, and</span>
<span class="w">                                     </span><span class="c">!! use `atol = 0.0` (or `atol(i) = 0.0`) for pure relative error</span>
<span class="w">                                     </span><span class="c">!! control.  caution: actual (global) errors may exceed these</span>
<span class="w">                                     </span><span class="c">!! local tolerances, so choose them conservatively.</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lrw</span><span class="w"> </span><span class="c">!! the length of the array rwork, as declared by the user.</span>
<span class="w">                                </span><span class="c">!! (this will be checked by the solver.)</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">lrw</span><span class="p">)</span><span class="w"> </span><span class="c">!! a real working array.</span>
<span class="w">                             </span><span class="c">!! the length of `rwork` must be at least</span>
<span class="w">                             </span><span class="c">!! `20 + nyh*(maxord + 1) + 3*neq + lwm` where:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `nyh`    = the initial value of neq,</span>
<span class="w">                             </span><span class="c">!!  * `maxord` = 12 (if `meth` = 1) or 5 (if `meth` = 2) (unless a</span>
<span class="w">                             </span><span class="c">!!               smaller value is given as an optional input),</span>
<span class="w">                             </span><span class="c">!!  * `lwm` = length of work space for matrix-related data:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!      * `lwm = 0                    ` if `miter` = 0,</span>
<span class="w">                             </span><span class="c">!!      * `lwm = 2*neq**2 + 2         ` if `miter` = 1 or 2, and `mf`&gt;0,</span>
<span class="w">                             </span><span class="c">!!      * `lwm = neq**2 + 2           ` if `miter` = 1 or 2, and `mf`&lt;0,</span>
<span class="w">                             </span><span class="c">!!      * `lwm = neq + 2              ` if `miter` = 3,</span>
<span class="w">                             </span><span class="c">!!      * `lwm = (3*ml+2*mu+2)*neq + 2` if `miter` = 4 or 5, and `mf`&gt;0,</span>
<span class="w">                             </span><span class="c">!!      * `lwm = (2*ml+mu+1)*neq + 2  ` if `miter` = 4 or 5, and `mf`&lt;0.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! (see the `mf` description for `meth` and `miter`.)</span>
<span class="w">                             </span><span class="c">!! thus if maxord has its default value and `neq` is constant,</span>
<span class="w">                             </span><span class="c">!! this length is:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `20 + 16*neq                  `  for `mf` = 10,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 16*neq + 2*neq**2       `  for `mf` = 11 or 12,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 16*neq + neq**2         `  for `mf` = -11 or -12,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 17*neq                  `  for `mf` = 13,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 18*neq + (3*ml+2*mu)*neq`  for `mf` = 14 or 15,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 17*neq + (2*ml+mu)*neq  `  for `mf` = -14 or -15,</span>
<span class="w">                             </span><span class="c">!!  * `20 +  9*neq                  `  for `mf` = 20,</span>
<span class="w">                             </span><span class="c">!!  * `22 +  9*neq + 2*neq**2       `  for `mf` = 21 or 22,</span>
<span class="w">                             </span><span class="c">!!  * `22 +  9*neq + neq**2         `  for `mf` = -21 or -22,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 10*neq                  `  for `mf` = 23,</span>
<span class="w">                             </span><span class="c">!!  * `22 + 11*neq + (3*ml+2*mu)*neq`  for `mf` = 24 or 25.</span>
<span class="w">                             </span><span class="c">!!  * `22 + 10*neq + (2*ml+mu)*neq  `  for `mf` = -24 or -25.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! the first 20 words of `rwork` are reserved for conditional</span>
<span class="w">                             </span><span class="c">!! and optional input and optional output.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! `rwork` can also used for conditional and</span>
<span class="w">                             </span><span class="c">!! optional input and optional output.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! the following word in `rwork` is a conditional input:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(1) = tcrit` = critical value of `t` which the solver</span>
<span class="w">                             </span><span class="c">!!    is not to overshoot.  required if `itask` is</span>
<span class="w">                             </span><span class="c">!!    4 or 5, and ignored otherwise.  (see `itask`.)</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! The following optional input requires `iopt = 1`, and in that</span>
<span class="w">                             </span><span class="c">!! case all of this input is examined.  a value of zero for any</span>
<span class="w">                             </span><span class="c">!! of these optional input variables will cause the default value to be</span>
<span class="w">                             </span><span class="c">!! used.  thus to use a subset of the optional input, simply preload</span>
<span class="w">                             </span><span class="c">!! locations 5 to 10 in `rwork` to 0.0, and</span>
<span class="w">                             </span><span class="c">!! then set those of interest to nonzero values:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(5) = h0` = the step size to be attempted on the first step.</span>
<span class="w">                             </span><span class="c">!!    the default value is determined by the solver.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(6) = hmax` = the maximum absolute step size allowed.</span>
<span class="w">                             </span><span class="c">!!    the default value is infinite.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(7) = hmin` = the minimum absolute step size allowed.</span>
<span class="w">                             </span><span class="c">!!    the default value is 0.  (this lower bound is not</span>
<span class="w">                             </span><span class="c">!!    enforced on the final step before reaching `tcrit`</span>
<span class="w">                             </span><span class="c">!!    when `itask = 4 or 5`.)</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! the following optional outputs</span>
<span class="w">                             </span><span class="c">!! below are quantities related to the performance of [[dvode]]</span>
<span class="w">                             </span><span class="c">!! which are available to the user.</span>
<span class="w">                             </span><span class="c">!! except where stated otherwise, all of this output is defined</span>
<span class="w">                             </span><span class="c">!! on any successful return from [[dvode]], and on any return with</span>
<span class="w">                             </span><span class="c">!! istate = -1, -2, -4, -5, or -6.  on an illegal input return</span>
<span class="w">                             </span><span class="c">!! (istate = -3), they will be unchanged from their existing values</span>
<span class="w">                             </span><span class="c">!! (if any), except possibly for `tolsf`.</span>
<span class="w">                             </span><span class="c">!! on any error return, output relevant to the error will be defined,</span>
<span class="w">                             </span><span class="c">!! as noted below:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(11) = hu` = the step size in t last used (successfully).</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(12) = hcur` = the step size to be attempted on the next step.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(13) = tcur` = the current value of the independent variable</span>
<span class="w">                             </span><span class="c">!!    which the solver has actually reached, i.e. the</span>
<span class="w">                             </span><span class="c">!!    current internal mesh point in t.  in the output,</span>
<span class="w">                             </span><span class="c">!!    tcur will always be at least as far from the</span>
<span class="w">                             </span><span class="c">!!    initial value of t as the current argument t,</span>
<span class="w">                             </span><span class="c">!!    but may be farther (if interpolation was done).</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! * `rwork(14) = tolsf` = a tolerance scale factor, greater than 1.0,</span>
<span class="w">                             </span><span class="c">!!   computed when a request for too much accuracy was</span>
<span class="w">                             </span><span class="c">!!   detected (istate = -3 if detected at the start of</span>
<span class="w">                             </span><span class="c">!!   the problem, istate = -2 otherwise).  if itol is</span>
<span class="w">                             </span><span class="c">!!   left unaltered but rtol and atol are uniformly</span>
<span class="w">                             </span><span class="c">!!   scaled up by a factor of tolsf for the next call,</span>
<span class="w">                             </span><span class="c">!!   then the solver is deemed likely to succeed.</span>
<span class="w">                             </span><span class="c">!!   (the user may also ignore tolsf and alter the</span>
<span class="w">                             </span><span class="c">!!   tolerance parameters in any other way appropriate.)</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!! the following two arrays are segments of the `rwork` array which</span>
<span class="w">                             </span><span class="c">!! may also be of interest to the user as optional output:</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(21:) = yh` = the nordsieck history array, of size `nyh` by</span>
<span class="w">                             </span><span class="c">!!    `(nqcur + 1)`, where `nyh` is the initial value</span>
<span class="w">                             </span><span class="c">!!    of `neq`.  for `j = 0,1,...,nqcur`, column `j+1`</span>
<span class="w">                             </span><span class="c">!!    of `yh` contains `hcur**j/factorial(j)` times</span>
<span class="w">                             </span><span class="c">!!    the `j-th` derivative of the interpolating</span>
<span class="w">                             </span><span class="c">!!    polynomial currently representing the</span>
<span class="w">                             </span><span class="c">!!    solution, evaluated at `t = tcur`.</span>
<span class="w">                             </span><span class="c">!!</span>
<span class="w">                             </span><span class="c">!!  * `rwork(lenrw-neq+1:) = acor` = `lenrw-neq+1` array</span>
<span class="w">                             </span><span class="c">!!    of size `neq` used for the accumulated</span>
<span class="w">                             </span><span class="c">!!    corrections on each step, scaled in the output</span>
<span class="w">                             </span><span class="c">!!    to represent the estimated local error in `y`</span>
<span class="w">                             </span><span class="c">!!    on the last step.  this is the vector `e` in</span>
<span class="w">                             </span><span class="c">!!    the description of the error control.  it is</span>
<span class="w">                             </span><span class="c">!!    defined only on a successful return from [[dvode]].</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">neq</span><span class="w"> </span><span class="c">!! the size of the ode system (number of first order</span>
<span class="w">                                </span><span class="c">!! ordinary differential equations).</span>
<span class="w">                                </span><span class="c">!! `neq` may not be increased during the problem, but</span>
<span class="w">                                </span><span class="c">!! can be decreased (with `istate = 3` in the input).</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itol</span><span class="w"> </span><span class="c">!! an indicator for the type of error control.</span>
<span class="w">                                 </span><span class="c">!! 1 or 2 according as `atol` is a scalar or array.</span>
<span class="w">                                 </span><span class="c">!! see description under `atol`.</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itask</span><span class="w"> </span><span class="c">!! an index specifying the task to be performed.</span>
<span class="w">                                  </span><span class="c">!! input only.  itask has the following values and meanings:</span>
<span class="w">                                  </span><span class="c">!!</span>
<span class="w">                                  </span><span class="c">!!  * 1  means normal computation of output values of y(t) at</span>
<span class="w">                                  </span><span class="c">!!       t = tout (by overshooting and interpolating).</span>
<span class="w">                                  </span><span class="c">!! * 2  means take one step only and return.</span>
<span class="w">                                  </span><span class="c">!! * 3  means stop at the first internal mesh point at or</span>
<span class="w">                                  </span><span class="c">!!      beyond t = tout and return.</span>
<span class="w">                                  </span><span class="c">!! * 4  means normal computation of output values of y(t) at</span>
<span class="w">                                  </span><span class="c">!!      t = tout but without overshooting t = tcrit.</span>
<span class="w">                                  </span><span class="c">!!      tcrit must be input as rwork(1).  tcrit may be equal to</span>
<span class="w">                                  </span><span class="c">!!      or beyond tout, but not behind it in the direction of</span>
<span class="w">                                  </span><span class="c">!!      integration.  this option is useful if the problem</span>
<span class="w">                                  </span><span class="c">!!      has a singularity at or beyond t = tcrit.</span>
<span class="w">                                  </span><span class="c">!! * 5  means take one step, without passing tcrit, and return.</span>
<span class="w">                                  </span><span class="c">!!      tcrit must be input as rwork(1).</span>
<span class="w">                                  </span><span class="c">!!</span>
<span class="w">                                  </span><span class="c">!! note:  if itask = 4 or 5 and the solver reaches tcrit</span>
<span class="w">                                  </span><span class="c">!! (within roundoff), it will return t = tcrit (exactly) to</span>
<span class="w">                                  </span><span class="c">!! indicate this (unless itask = 4 and tout comes before tcrit,</span>
<span class="w">                                  </span><span class="c">!! in which case answers at t = tout are returned first).</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">istate</span><span class="w"> </span><span class="c">!! an index used for input and output to specify the</span>
<span class="w">                                      </span><span class="c">!! the state of the calculation.</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!! in the input, the values of istate are as follows:</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!!  1.  means this is the first call for the problem</span>
<span class="w">                                      </span><span class="c">!!      (initializations will be done).  see note below.</span>
<span class="w">                                      </span><span class="c">!!  2.  means this is not the first call, and the calculation</span>
<span class="w">                                      </span><span class="c">!!      is to continue normally, with no change in any input</span>
<span class="w">                                      </span><span class="c">!!      parameters except possibly tout and itask.</span>
<span class="w">                                      </span><span class="c">!!      (if itol, rtol, and/or atol are changed between calls</span>
<span class="w">                                      </span><span class="c">!!      with istate = 2, the new values will be used but not</span>
<span class="w">                                      </span><span class="c">!!      tested for legality.)</span>
<span class="w">                                      </span><span class="c">!!  3.  means this is not the first call, and the</span>
<span class="w">                                      </span><span class="c">!!      calculation is to continue normally, but with</span>
<span class="w">                                      </span><span class="c">!!      a change in input parameters other than</span>
<span class="w">                                      </span><span class="c">!!      tout and itask.  changes are allowed in</span>
<span class="w">                                      </span><span class="c">!!      neq, itol, rtol, atol, iopt, lrw, liw, mf, ml, mu,</span>
<span class="w">                                      </span><span class="c">!!      and any of the optional input except h0.</span>
<span class="w">                                      </span><span class="c">!!      (see iwork description for ml and mu.)</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!! note:  a preliminary call with tout = t is not counted</span>
<span class="w">                                      </span><span class="c">!! as a first call here, as no initialization or checking of</span>
<span class="w">                                      </span><span class="c">!! input is done.  (such a call is sometimes useful to include</span>
<span class="w">                                      </span><span class="c">!! the initial conditions in the output.)</span>
<span class="w">                                      </span><span class="c">!! thus the first call for which tout /= t requires</span>
<span class="w">                                      </span><span class="c">!! istate = 1 in the input.</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!! in the output, istate has the following values and meanings:</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!!  * 1  means nothing was done, as tout was equal to t with</span>
<span class="w">                                      </span><span class="c">!!      istate = 1 in the input.</span>
<span class="w">                                      </span><span class="c">!!  * 2  means the integration was performed successfully.</span>
<span class="w">                                      </span><span class="c">!!  * -1  means an excessive amount of work (more than mxstep</span>
<span class="w">                                      </span><span class="c">!!       steps) was done on this call, before completing the</span>
<span class="w">                                      </span><span class="c">!!       requested task, but the integration was otherwise</span>
<span class="w">                                      </span><span class="c">!!       successful as far as t.  (mxstep is an optional input</span>
<span class="w">                                      </span><span class="c">!!       and is normally 500.)  to continue, the user may</span>
<span class="w">                                      </span><span class="c">!!       simply reset istate to a value &gt; 1 and call again.</span>
<span class="w">                                      </span><span class="c">!!       (the excess work step counter will be reset to 0.)</span>
<span class="w">                                      </span><span class="c">!!       in addition, the user may increase mxstep to avoid</span>
<span class="w">                                      </span><span class="c">!!       this error return.  (see optional input below.)</span>
<span class="w">                                      </span><span class="c">!!  * -2  means too much accuracy was requested for the precision</span>
<span class="w">                                      </span><span class="c">!!       of the machine being used.  this was detected before</span>
<span class="w">                                      </span><span class="c">!!       completing the requested task, but the integration</span>
<span class="w">                                      </span><span class="c">!!       was successful as far as t.  to continue, the tolerance</span>
<span class="w">                                      </span><span class="c">!!       parameters must be reset, and istate must be set</span>
<span class="w">                                      </span><span class="c">!!       to 3.  the optional output tolsf may be used for this</span>
<span class="w">                                      </span><span class="c">!!       purpose.  (note: if this condition is detected before</span>
<span class="w">                                      </span><span class="c">!!       taking any steps, then an illegal input return</span>
<span class="w">                                      </span><span class="c">!!       (istate = -3) occurs instead.)</span>
<span class="w">                                      </span><span class="c">!!  * -3  means illegal input was detected, before taking any</span>
<span class="w">                                      </span><span class="c">!!       integration steps.  see written message for details.</span>
<span class="w">                                      </span><span class="c">!!       note:  if the solver detects an infinite loop of calls</span>
<span class="w">                                      </span><span class="c">!!       to the solver with illegal input, it will cause</span>
<span class="w">                                      </span><span class="c">!!       the run to stop.</span>
<span class="w">                                      </span><span class="c">!!  * -4  means there were repeated error test failures on</span>
<span class="w">                                      </span><span class="c">!!       one attempted step, before completing the requested</span>
<span class="w">                                      </span><span class="c">!!       task, but the integration was successful as far as t.</span>
<span class="w">                                      </span><span class="c">!!       the problem may have a singularity, or the input</span>
<span class="w">                                      </span><span class="c">!!       may be inappropriate.</span>
<span class="w">                                      </span><span class="c">!!  * -5  means there were repeated convergence test failures on</span>
<span class="w">                                      </span><span class="c">!!       one attempted step, before completing the requested</span>
<span class="w">                                      </span><span class="c">!!       task, but the integration was successful as far as t.</span>
<span class="w">                                      </span><span class="c">!!       this may be caused by an inaccurate jacobian matrix,</span>
<span class="w">                                      </span><span class="c">!!       if one is being used.</span>
<span class="w">                                      </span><span class="c">!!  * -6  means ewt(i) became zero for some i during the</span>
<span class="w">                                      </span><span class="c">!!       integration.  pure relative error control (atol(i)=0.0)</span>
<span class="w">                                      </span><span class="c">!!       was requested on a variable which has now vanished.</span>
<span class="w">                                      </span><span class="c">!!       the integration was successful as far as t.</span>
<span class="w">                                      </span><span class="c">!!</span>
<span class="w">                                      </span><span class="c">!! note:  since the normal output value of istate is 2,</span>
<span class="w">                                      </span><span class="c">!! it does not need to be reset for normal continuation.</span>
<span class="w">                                      </span><span class="c">!! also, since a negative input value of istate will be</span>
<span class="w">                                      </span><span class="c">!! regarded as illegal, a negative output value requires the</span>
<span class="w">                                      </span><span class="c">!! user to change it, and possibly other input, before</span>
<span class="w">                                      </span><span class="c">!! calling the solver again.</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iopt</span><span class="w"> </span><span class="c">!! an integer flag to specify whether or not any optional</span>
<span class="w">                                 </span><span class="c">!! input is being used on this call.</span>
<span class="w">                                 </span><span class="c">!! the optional input is listed separately below.</span>
<span class="w">                                 </span><span class="c">!!</span>
<span class="w">                                 </span><span class="c">!!  * iopt = 0 means no optional input is being used.</span>
<span class="w">                                 </span><span class="c">!!    default values will be used in all cases.</span>
<span class="w">                                 </span><span class="c">!!  * iopt = 1 means optional input is being used.</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">liw</span><span class="w"> </span><span class="c">!! the length of the array iwork, as declared by the user.</span>
<span class="w">                                </span><span class="c">!! (this will be checked by the solver.)</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="n">liw</span><span class="p">)</span><span class="w"> </span><span class="c">!! an integer work array.  the length of iwork must be at least:</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `30`        if miter = 0 or 3 (mf = 10, 13, 20, 23), or</span>
<span class="w">                            </span><span class="c">!!  * `30 + neq`  otherwise (abs(mf) = 11,12,14,15,21,22,24,25).</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!! the first 30 words of `iwork` are reserved for conditional and</span>
<span class="w">                            </span><span class="c">!! optional input and optional output.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!! the following 2 words in `iwork` are conditional input:</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `iwork(1) = ml`</span>
<span class="w">                            </span><span class="c">!!  * `iwork(2) = mu`</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!! these are the lower and upper</span>
<span class="w">                            </span><span class="c">!! half-bandwidths, respectively, of the</span>
<span class="w">                            </span><span class="c">!! banded jacobian, excluding the main diagonal.</span>
<span class="w">                            </span><span class="c">!! the band is defined by the matrix locations</span>
<span class="w">                            </span><span class="c">!! `(i,j)` with `i-ml &lt;= j &lt;= i+mu`.  `ml` and `mu`</span>
<span class="w">                            </span><span class="c">!! must satisfy  `0 &lt;=  ml,mu  &lt;= neq-1`.</span>
<span class="w">                            </span><span class="c">!! these are required if `miter` is 4 or 5, and</span>
<span class="w">                            </span><span class="c">!! ignored otherwise.  `ml` and `mu` may in fact be</span>
<span class="w">                            </span><span class="c">!! the band parameters for a matrix to which</span>
<span class="w">                            </span><span class="c">!! `df/dy` is only approximately equal.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!! The following optional input requires `iopt = 1`, and in that</span>
<span class="w">                            </span><span class="c">!! case all of this input is examined.  a value of zero for any</span>
<span class="w">                            </span><span class="c">!! of these optional input variables will cause the default value to be</span>
<span class="w">                            </span><span class="c">!! used.  thus to use a subset of the optional input, simply preload</span>
<span class="w">                            </span><span class="c">!! locations 5 to 10 in `iwork` to 0, and</span>
<span class="w">                            </span><span class="c">!! then set those of interest to nonzero values.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `iwork(5) = maxord` = the maximum order to be allowed.  the default</span>
<span class="w">                            </span><span class="c">!!    value is 12 if `meth = 1`, and 5 if `meth = 2`.</span>
<span class="w">                            </span><span class="c">!!    if `maxord` exceeds the default value, it will</span>
<span class="w">                            </span><span class="c">!!    be reduced to the default value.</span>
<span class="w">                            </span><span class="c">!!    if `maxord` is changed during the problem, it may</span>
<span class="w">                            </span><span class="c">!!    cause the current order to be reduced.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `iwork(6) = mxstep` = maximum number of (internally defined) steps</span>
<span class="w">                            </span><span class="c">!!    allowed during one call to the solver.</span>
<span class="w">                            </span><span class="c">!!    the default value is 500.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `iwork(7) = mxhnil` = maximum number of messages printed (per problem)</span>
<span class="w">                            </span><span class="c">!!    warning that `t + h = t` on a step (`h` = step size).</span>
<span class="w">                            </span><span class="c">!!    this must be positive to result in a non-default</span>
<span class="w">                            </span><span class="c">!!    value.  the default value is 10.</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!! as optional additional output from dvode, the variables listed</span>
<span class="w">                            </span><span class="c">!! below are quantities related to the performance of dvode</span>
<span class="w">                            </span><span class="c">!! which are available to the user.</span>
<span class="w">                            </span><span class="c">!! except where stated otherwise, all of this output is defined</span>
<span class="w">                            </span><span class="c">!! on any successful return from dvode, and on any return with</span>
<span class="w">                            </span><span class="c">!! istate = -1, -2, -4, -5, or -6.  on an illegal input return</span>
<span class="w">                            </span><span class="c">!! (istate = -3), they will be unchanged from their existing values</span>
<span class="w">                            </span><span class="c">!! (if any), except possibly for `lenrw`, and `leniw`.</span>
<span class="w">                            </span><span class="c">!! on any error return, output relevant to the error will be defined,</span>
<span class="w">                            </span><span class="c">!! as noted below:</span>
<span class="w">                            </span><span class="c">!!</span>
<span class="w">                            </span><span class="c">!!  * `iwork(11) = nst` = the number of steps taken for the problem so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(12) = nfe` = the number of f evaluations for the problem so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(13) = nje` = the number of jacobian evaluations so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(14) = nqu` = the method order last used (successfully).</span>
<span class="w">                            </span><span class="c">!!  * `iwork(15) = nqcur` = the order to be attempted on the next step.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(16) = imxer` = the index of the component of largest magnitude in</span>
<span class="w">                            </span><span class="c">!!    the weighted local error vector ( e(i)/ewt(i) ),</span>
<span class="w">                            </span><span class="c">!!    on an error return with istate = -4 or -5.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(17) = lenrw` = the length of rwork actually required.</span>
<span class="w">                            </span><span class="c">!!    this is defined on normal returns and on an illegal</span>
<span class="w">                            </span><span class="c">!!    input return for insufficient storage.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(18) = leniw` = the length of iwork actually required.</span>
<span class="w">                            </span><span class="c">!!     this is defined on normal returns and on an illegal</span>
<span class="w">                            </span><span class="c">!!     input return for insufficient storage.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(19) = nlu` = the number of matrix lu decompositions so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(20) = nni` = the number of nonlinear (newton) iterations so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(21) = ncfn` = the number of convergence failures of the nonlinear</span>
<span class="w">                            </span><span class="c">!!    solver so far.</span>
<span class="w">                            </span><span class="c">!!  * `iwork(22) = netf` = the number of error test failures of the integrator</span>
<span class="w">                            </span><span class="c">!!    so far.</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mf</span><span class="w"> </span><span class="c">!! method flag.  standard values are:</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!!  * 10 for nonstiff (adams) method, no jacobian used.</span>
<span class="w">                               </span><span class="c">!!  * 21 for stiff (bdf) method, user-supplied full jacobian.</span>
<span class="w">                               </span><span class="c">!!  * 22 for stiff method, internally generated full jacobian.</span>
<span class="w">                               </span><span class="c">!!  * 24 for stiff method, user-supplied banded jacobian.</span>
<span class="w">                               </span><span class="c">!!  * 25 for stiff method, internally generated banded jacobian.</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! the complete set of legal values of</span>
<span class="w">                               </span><span class="c">!! mf are 10, 11, 12, 13, 14, 15, 20, 21, 22, 23, 24, 25,</span>
<span class="w">                               </span><span class="c">!! -11, -12, -14, -15, -21, -22, -24, -25.</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! `mf` is a signed two-digit integer, `mf = jsv*(10*meth + miter)`</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! `jsv = sign(mf)` indicates the jacobian-saving strategy:</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!!  * jsv =  1 means a copy of the jacobian is saved for reuse</span>
<span class="w">                               </span><span class="c">!!           in the corrector iteration algorithm.</span>
<span class="w">                               </span><span class="c">!!  * jsv = -1 means a copy of the jacobian is not saved</span>
<span class="w">                               </span><span class="c">!!          (valid only for miter = 1, 2, 4, or 5).</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! `meth` indicates the basic linear multistep method:</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!!  * meth = 1 means the implicit adams method.</span>
<span class="w">                               </span><span class="c">!!  * meth = 2 means the method based on backward</span>
<span class="w">                               </span><span class="c">!!           differentiation formulas (bdf-s).</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! `miter` indicates the corrector iteration method:</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!!  * miter = 0 means functional iteration (no jacobian matrix</span>
<span class="w">                               </span><span class="c">!!    is involved).</span>
<span class="w">                               </span><span class="c">!!  * miter = 1 means chord iteration with a user-supplied</span>
<span class="w">                               </span><span class="c">!!    full (neq by neq) jacobian.</span>
<span class="w">                               </span><span class="c">!!  * miter = 2 means chord iteration with an internally</span>
<span class="w">                               </span><span class="c">!!    generated (difference quotient) full jacobian</span>
<span class="w">                               </span><span class="c">!!    (using neq extra calls to f per df/dy value).</span>
<span class="w">                               </span><span class="c">!!  * miter = 3 means chord iteration with an internally</span>
<span class="w">                               </span><span class="c">!!    generated diagonal jacobian approximation</span>
<span class="w">                               </span><span class="c">!!    (using 1 extra call to f per df/dy evaluation).</span>
<span class="w">                               </span><span class="c">!!  * miter = 4 means chord iteration with a user-supplied</span>
<span class="w">                               </span><span class="c">!!    banded jacobian.</span>
<span class="w">                               </span><span class="c">!!  * miter = 5 means chord iteration with an internally</span>
<span class="w">                               </span><span class="c">!!    generated banded jacobian (using ml+mu+1 extra</span>
<span class="w">                               </span><span class="c">!!    calls to f per df/dy evaluation).</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!! if miter = 1 or 4, the user must supply a subroutine `jac`</span>
<span class="w">                               </span><span class="c">!! (the name is arbitrary) as described above under `jac`.</span>
<span class="w">                               </span><span class="c">!! for other values of miter, a dummy argument can be used.</span>

<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ihit</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">atoli</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ewti</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">h0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">hmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">hmx</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">rh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rtoli</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tcrit</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">tnext</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tolsf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tp</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iflag</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">imxer</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jco</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kgo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">leniw</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                 </span><span class="n">lenp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenrw</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenwm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lf0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mband</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mfa</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ml</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                 </span><span class="n">mu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">niter</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nslast</span>
<span class="w">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">msg</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mxhnl0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mxstp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">one</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">two</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">four</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pt2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">hun</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="mf">0.0_wp</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block a.</span>
<span class="w">      </span><span class="c">! this code block is executed on every call.</span>
<span class="w">      </span><span class="c">! it tests istate and itask for legality and branches appropriately.</span>
<span class="w">      </span><span class="c">! if istate &gt; 1 but the flag init shows that initialization has</span>
<span class="w">      </span><span class="c">! not yet been done, an error return occurs.</span>
<span class="w">      </span><span class="c">! if istate = 1 and tout = t, return immediately.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">istate</span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="c">! block i.</span>
<span class="w">         </span><span class="c">! the following block handles all error returns due to illegal input</span>
<span class="w">         </span><span class="c">! (istate = -3), as detected before calling the core integrator.</span>
<span class="w">         </span><span class="c">! first the error message routine is called.   if the illegal input</span>
<span class="w">         </span><span class="c">! is a negative istate, the run is aborted (apparent infinite loop).</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  istate (=i1) illegal &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">istate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  run aborted:  apparent infinite loop     &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">303</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itask</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itask</span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask (=i1) illegal  &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">itask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tout</span><span class="o">==</span><span class="n">t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="k">      else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">init</span><span class="o">/=</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  istate (=i1) &gt; 1 but dvode not initialized      &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">istate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         goto</span><span class="w"> </span><span class="mi">50</span>
<span class="w">      </span><span class="k">endif</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block b.</span>
<span class="w">      </span><span class="c">! the next code block is executed for the initial call (istate = 1),</span>
<span class="w">      </span><span class="c">! or for a continuation call with parameter changes (istate = 3).</span>
<span class="w">      </span><span class="c">! it contains checking of all input and various initializations.</span>
<span class="w">      </span><span class="c">!</span>
<span class="w">      </span><span class="c">! first check legality of the non-optional input neq, itol, iopt,</span>
<span class="w">      </span><span class="c">! mf, ml, and mu.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">neq</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  neq (=i1) &lt; 1     &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">neq</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">/=</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">neq</span><span class="o">&gt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  istate = 3 and neq increased (i1 to i2)  &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">neq</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         endif</span>
<span class="k">      endif</span>
<span class="k">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">neq</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itol</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itol</span><span class="o">&gt;</span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itol (=i1) illegal   &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">itol</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iopt</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iopt</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  iopt (=i1) illegal   &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iopt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      else</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jsv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mf</span><span class="p">)</span>
<span class="w">         </span><span class="n">mfa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfa</span><span class="o">/</span><span class="mi">10</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span><span class="o">&gt;</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">               </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  mf (=i1) illegal     &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mf</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">ml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ml</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ml</span><span class="o">&gt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  ml (=i1) illegal:  &lt;0 or &gt;=neq (=i2)&#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ml</span><span class="p">,</span><span class="n">neq</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mu</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mu</span><span class="o">&gt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  mu (=i1) illegal:  &lt;0 or &gt;=neq (=i2)&#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">neq</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            endif</span>
<span class="k">         endif</span>
<span class="w">         </span><span class="c">! next process and check the optional input. ---------------------------</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iopt</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  maxord (=i1) &lt; 0  &#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            else</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="p">,</span><span class="n">mord</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span><span class="p">))</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  mxstep (=i1) &lt; 0  &#39;</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                  </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               else</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxstp0</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  mxhnil (=i1) &lt; 0  &#39;</span>
<span class="w">                     </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                     </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                     </span><span class="k">return</span>
<span class="k">                  else</span>
<span class="k">                     if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxhnl0</span>
<span class="w">                     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">h0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tout</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">h0</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                           </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  tout (=r1) behind t (=r2)      &#39;</span>
<span class="w">                           </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">                           </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      integration direction is given by h0 (=r1)  &#39;</span>
<span class="w">                           </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                           </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                           </span><span class="k">return</span>
<span class="k">                        endif</span>
<span class="k">                     endif</span>
<span class="k">                     </span><span class="n">hmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">                     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hmax</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  hmax (=r1) &lt; 0.0  &#39;</span>
<span class="w">                        </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">hmax</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                        </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                        </span><span class="k">return</span>
<span class="k">                     else</span>
<span class="k">                        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hmax</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">hmax</span>
<span class="w">                        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                           </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  hmin (=r1) &lt; 0.0  &#39;</span>
<span class="w">                           </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                           </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                           </span><span class="k">return</span>
<span class="k">                        endif</span>
<span class="k">                     endif</span>
<span class="k">                  endif</span>
<span class="k">               endif</span>
<span class="k">            endif</span>
<span class="k">         else</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mord</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">meth</span><span class="p">)</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxstp0</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxhnl0</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">h0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">         </span><span class="k">endif</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="c">! set work array pointers and check lengths lrw and liw.</span>
<span class="w">         </span><span class="c">! pointers to segments of rwork and iwork are named by prefixing l to</span>
<span class="w">         </span><span class="c">! the name of the segment.  e.g., the segment yh starts at rwork(lyh).</span>
<span class="w">         </span><span class="c">! segments of rwork (in order) are denoted  yh, wm, ewt, savf, acor.</span>
<span class="w">         </span><span class="c">! within wm, locjs is the location of the saved jacobian (jsv &gt; 0).</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">21</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span>
<span class="w">         </span><span class="n">jco</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jsv</span><span class="p">)</span>
<span class="w">         </span><span class="k">select case</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="p">)</span>
<span class="w">         </span><span class="k">case</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">lenwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<span class="w">            </span><span class="n">lenwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">jco</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">locjs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
<span class="w">         </span><span class="k">case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">            </span><span class="n">lenwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">         </span><span class="k">case</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
<span class="w">            </span><span class="n">mband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ml</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">lenp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">mband</span><span class="o">+</span><span class="n">ml</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">            </span><span class="n">lenj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mband</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">            </span><span class="n">lenwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lenp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jco</span><span class="o">*</span><span class="n">lenj</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">locjs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
<span class="w">         </span><span class="k">end select</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lenwm</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lsavf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lacor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lsavf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">         </span><span class="n">lenrw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lacor</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenrw</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">liwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">leniw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">==</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">leniw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leniw</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lenrw</span><span class="o">&gt;</span><span class="n">lrw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  rwork length needed, lenrw (=i1), exceeds lrw (=i2)&#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lenrw</span><span class="p">,</span><span class="n">lrw</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">leniw</span><span class="o">&gt;</span><span class="n">liw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  iwork length needed, leniw (=i1), exceeds liw (=i2)&#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">leniw</span><span class="p">,</span><span class="n">liw</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else</span>
<span class="w">            </span><span class="c">! check rtol and atol for legality. ------------------------------------</span>
<span class="w">            </span><span class="n">rtoli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="n">atoli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itol</span><span class="o">&gt;=</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">rtoli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itol</span><span class="o">==</span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itol</span><span class="o">==</span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">atoli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtoli</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  rtol(i1) is r1 &lt; 0.0        &#39;</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">rtoli</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                  </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               end if</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">atoli</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  atol(i1) is r1 &lt; 0.0        &#39;</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">atoli</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                  </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               end if</span>
<span class="k">            enddo</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istate</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="c">! block c.</span>
<span class="w">               </span><span class="c">! the next block is for the initial call only (istate = 1).</span>
<span class="w">               </span><span class="c">! it contains all remaining initializations, the initial call to f,</span>
<span class="w">               </span><span class="c">! and the calculation of the initial step size.</span>
<span class="w">               </span><span class="c">! the error weights in ewt are inverted after being loaded.</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epmach</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">4</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">tcrit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tcrit</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tout</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask = 4 or 5 and tcrit (=r1) behind tout (=r2)   &#39;</span>
<span class="w">                     </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tcrit</span><span class="p">,</span><span class="n">tout</span><span class="p">)</span>
<span class="w">                     </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                     </span><span class="k">return</span>
<span class="k">                  end if</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">h0</span><span class="o">/=</span><span class="n">zero</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h0</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">*</span><span class="n">h0</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">h0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcrit</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ccmxj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt2</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">msbj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nhnil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nje</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nni</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ncfn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">netf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nlu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nslj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">nslast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="c">! initial call to f.  (lf0 points to yh(*,2).) -------------------------</span>
<span class="w">               </span><span class="n">lf0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">rwork</span><span class="p">(</span><span class="n">lf0</span><span class="p">))</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">               </span><span class="c">! load the initial value vector in yh. ---------------------------------</span>
<span class="w">               </span><span class="k">call </span><span class="n">dcopy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="c">! load and invert the ewt array.  (h is temporarily set to 1.0.) -------</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dewset</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">itol</span><span class="p">,</span><span class="n">rtol</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">atol</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),&amp;</span>
<span class="w">                              </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="p">))</span>
<span class="w">               </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     </span><span class="n">ewti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                     </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  ewt(i1) is r1 &lt;= 0.0         &#39;</span>
<span class="w">                     </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ewti</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                     </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                     </span><span class="k">return</span>
<span class="k">                  end if</span>
<span class="k">                  </span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="k">enddo</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">h0</span><span class="o">==</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                  </span><span class="c">! call dvhin to set initial step size h0 to be attempted. --------------</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvhin</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">rwork</span><span class="p">(</span><span class="n">lf0</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">tout</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="p">),</span><span class="n">itol</span><span class="p">,&amp;</span>
<span class="w">                                 </span><span class="n">atol</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lacor</span><span class="p">),</span><span class="n">h0</span><span class="p">,</span><span class="n">niter</span><span class="p">,</span><span class="n">ier</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">niter</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ier</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="s1">&#39;dvode--  tout (=r1) too close to t(=r2) to start integration&#39;</span>
<span class="w">                     </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">                     </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">                     </span><span class="k">return</span>
<span class="k">                  endif</span>
<span class="k">               endif</span>
<span class="w">               </span><span class="c">! adjust h0 if necessary to meet hmax bound. ---------------------------</span>
<span class="w">               </span><span class="n">rh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rh</span><span class="o">&gt;</span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">h0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h0</span><span class="o">/</span><span class="n">rh</span>
<span class="w">               </span><span class="c">! load h with h0 and scale yh(*,2) by h0. ------------------------------</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h0</span>
<span class="w">               </span><span class="k">call </span><span class="n">dscal</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">lf0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="k">goto</span><span class="w"> </span><span class="mi">200</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">               </span><span class="c">! if istate = 3, set flag to signal parameter changes to dvstep. -------</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">               </span><span class="c">! maxord was reduced below nq.  copy yh(*,maxord+2) into savf. ---------</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">&gt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="k">call </span><span class="n">dcopy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lsavf</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="c">! reload wm(1) = rwork(lwm), since lwm may have changed. ---------------</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">miter</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">            </span><span class="k">endif</span>
<span class="k">         endif</span>
<span class="k">      endif</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block d.</span>
<span class="w">      </span><span class="c">! the next code block is for continuation calls only (istate = 2 or 3)</span>
<span class="w">      </span><span class="c">! and is to check stop conditions before taking a step.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="mi">50</span><span class="w">    </span><span class="n">nslast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="k">select case</span><span class="w"> </span><span class="p">(</span><span class="n">itask</span><span class="p">)</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">         </span><span class="k">goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">         </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hu</span><span class="o">*</span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">hun</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tp</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask = i1 and tout (=r1) behind tcur - hu (= r2)  &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">itask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tp</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;=</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               call </span><span class="n">set_y_and_t</span><span class="p">()</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">4</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ihit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcrit</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">               call continue</span><span class="p">()</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            end if</span>
<span class="k">            goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">         </span><span class="k">endif</span>
<span class="k">      case</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">         </span><span class="n">tcrit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask = 4 or 5 and tcrit (=r1) behind tcur (=r2)   &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tcrit</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tcrit</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask = 4 or 5 and tcrit (=r1) behind tout (=r2)   &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tcrit</span><span class="p">,</span><span class="n">tout</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;=</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            call </span><span class="n">me</span><span class="p">%</span><span class="n">dvindy</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">iflag</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iflag</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  trouble from dvindy.  itask = i1, tout = r1.       &#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">itask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            end if</span>
<span class="k">            </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tout</span>
<span class="w">            </span><span class="k">call continue</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         endif</span>
<span class="k">      case</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">         </span><span class="n">tcrit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  itask = 4 or 5 and tcrit (=r1) behind tcur (=r2)   &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tcrit</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">      case </span><span class="n">default</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvindy</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">iflag</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iflag</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  trouble from dvindy.  itask = i1, tout = r1.       &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">itask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         end if</span>
<span class="k">         </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tout</span>
<span class="w">         </span><span class="k">call continue</span><span class="p">()</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end select</span>
<span class="k">      </span><span class="n">hmx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">      </span><span class="n">ihit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">hun</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="o">*</span><span class="n">hmx</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ihit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">set_y_and_t</span><span class="p">()</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">4</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ihit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcrit</span>
<span class="w">         </span><span class="k">endif</span>
<span class="k">         call continue</span><span class="p">()</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>
<span class="k">      </span><span class="n">tnext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span><span class="o">*</span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">four</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tnext</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tcrit</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">four</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">endif</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block e.</span>
<span class="w">      </span><span class="c">! the next block is normally executed for all calls and contains</span>
<span class="w">      </span><span class="c">! the call to the one-step core integrator dvstep.</span>
<span class="w">      </span><span class="c">!</span>
<span class="w">      </span><span class="c">! this is a looping point for the integration steps.</span>
<span class="w">      </span><span class="c">!</span>
<span class="w">      </span><span class="c">! first check for too many steps being taken, update ewt (if not at</span>
<span class="w">      </span><span class="c">! start of problem), check for too much accuracy being requested, and</span>
<span class="w">      </span><span class="c">! check for h below the roundoff level in t.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="o">-</span><span class="n">nslast</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block h.</span>
<span class="w">      </span><span class="c">! the following block handles all unsuccessful returns other than</span>
<span class="w">      </span><span class="c">! those for illegal input.  first the error message routine is called.</span>
<span class="w">      </span><span class="c">! if there was an error test or convergence test failure, imxer is set.</span>
<span class="w">      </span><span class="c">! then y is loaded from yh, and t is set to tn.</span>
<span class="w">      </span><span class="c">! the optional output is loaded into the work arrays before returning.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! the maximum number of steps was taken before reaching tout. ----------</span>
<span class="w">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at current t (=r1), mxstep (=i1) steps   &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      taken on this call before reaching tout     &#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxstep</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">         </span><span class="k">call </span><span class="n">finish</span><span class="p">()</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      else</span>
<span class="k">         call </span><span class="n">me</span><span class="p">%</span><span class="n">dewset</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">itol</span><span class="p">,</span><span class="n">rtol</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">atol</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),&amp;</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="p">))</span>
<span class="w">         </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               call </span><span class="n">ewt_error</span><span class="p">()</span>
<span class="w">               </span><span class="k">call </span><span class="n">finish</span><span class="p">()</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            end if</span>
<span class="k">            </span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="k">enddo</span>
<span class="k">      endif</span>
<span class="k"> </span><span class="mi">200</span><span class="w">  </span><span class="n">tolsf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dvnorm</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="p">))</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tolsf</span><span class="o">&lt;=</span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nhnil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nhnil</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nhnil</span><span class="o">&lt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  warning: internal t (=r1) and h (=r2) are&#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      such that in the machine, t + h = t on the next step  &#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      (h = step size). solver will continue anyway&#39;</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nhnil</span><span class="o">&gt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  above warning has been issued i1 times.  &#39;</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">                  </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      it will not be issued again for this problem&#39;</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">mxhnil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">            endif</span>
<span class="k">         endif</span>
<span class="k">         call </span><span class="n">me</span><span class="p">%</span><span class="n">dvstep</span><span class="p">(</span><span class="n">y</span><span class="p">,&amp;</span><span class="w">                     </span><span class="c">! y</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),&amp;</span><span class="w">     </span><span class="c">! yh</span>
<span class="w">                        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="p">,&amp;</span><span class="w">            </span><span class="c">! nyh</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),&amp;</span><span class="w">     </span><span class="c">! yh</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w">   </span><span class="c">! ewt</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lsavf</span><span class="p">),&amp;</span><span class="w">   </span><span class="c">! savf</span>
<span class="w">                        </span><span class="n">y</span><span class="p">,&amp;</span><span class="w">                     </span><span class="c">! vsav</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lacor</span><span class="p">),&amp;</span><span class="w">   </span><span class="c">! acor</span>
<span class="w">                        </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lwm</span><span class="p">),&amp;</span><span class="w">     </span><span class="c">! wm</span>
<span class="w">                        </span><span class="n">iwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">liwm</span><span class="p">))</span><span class="w">     </span><span class="c">! iwm</span>
<span class="w">         </span><span class="n">kgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span>
<span class="w">         </span><span class="c">! branch on kflag.  note: in this version, kflag can not be set to -3.</span>
<span class="w">         </span><span class="c">!  kflag == 0,   -1,  -2</span>
<span class="w">         </span><span class="k">select case</span><span class="w"> </span><span class="p">(</span><span class="n">kgo</span><span class="p">)</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">            </span><span class="c">! kflag = -1.  error test failed repeatedly or with abs(h) = hmin. -----</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at t(=r1) and step size h(=r2), the error&#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      test failed repeatedly or with abs(h) = hmin&#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span>
<span class="w">            </span><span class="k">call </span><span class="n">compute_imxer</span><span class="p">()</span>
<span class="w">            </span><span class="k">call </span><span class="n">finish</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         case</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">            </span><span class="c">! kflag = -2.  convergence failed repeatedly or with abs(h) = hmin. ----</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at t (=r1) and step size h (=r2), the    &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      corrector convergence failed repeatedly     &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      or with abs(h) = hmin   &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span>
<span class="w">            </span><span class="k">call </span><span class="n">compute_imxer</span><span class="p">()</span>
<span class="w">            </span><span class="k">call </span><span class="n">finish</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         case </span><span class="n">default</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="c">! block f.</span>
<span class="w">            </span><span class="c">! the following block handles the case of a successful return from the</span>
<span class="w">            </span><span class="c">! core integrator (kflag = 0).  test for stop conditions.</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="k">select case</span><span class="w"> </span><span class="p">(</span><span class="n">itask</span><span class="p">)</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">               </span><span class="c">! itask = 3.  jump to exit if tout was reached. ------------------------</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">               </span><span class="c">! itask = 4.  see if tout or tcrit was reached.  adjust h if necessary.</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">hmx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">                  </span><span class="n">ihit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">hun</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="o">*</span><span class="n">hmx</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">ihit</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     </span><span class="n">tnext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span><span class="o">*</span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">four</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">                     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">tnext</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&gt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tcrit</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">four</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="p">)</span>
<span class="w">                        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                     </span><span class="k">endif</span>
<span class="k">                     goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">                  </span><span class="k">endif</span>
<span class="k">               else</span>
<span class="k">                  call </span><span class="n">me</span><span class="p">%</span><span class="n">dvindy</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">iflag</span><span class="p">)</span>
<span class="w">                  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tout</span>
<span class="w">                  </span><span class="k">call continue</span><span class="p">()</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               endif</span>
<span class="k">            case</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">               </span><span class="c">! itask = 5.  see if tcrit was reached and jump to exit. ---------------</span>
<span class="w">               </span><span class="n">hmx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span>
<span class="w">               </span><span class="n">ihit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tcrit</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">hun</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">uround</span><span class="o">*</span><span class="n">hmx</span>
<span class="w">            </span><span class="k">case </span><span class="n">default</span>
<span class="w">               </span><span class="c">! itask = 1.  if tout has been reached, interpolate. -------------------</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">&lt;</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">100</span>
<span class="w">               </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvindy</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nyh</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">iflag</span><span class="p">)</span>
<span class="w">               </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tout</span>
<span class="w">               </span><span class="k">call continue</span><span class="p">()</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            end select</span>
<span class="k">         end select</span>
<span class="k">      else</span>
<span class="k">         </span><span class="n">tolsf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tolsf</span><span class="o">*</span><span class="n">two</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at start of problem, too much accuracy   &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      requested for precision of machine:   see tolsf (=r1) &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tolsf</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">rwork</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tolsf</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else</span>
<span class="w">            </span><span class="c">! too much accuracy requested for machine precision. -------------------</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at t (=r1), too much accuracy requested  &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">)</span>
<span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;      for precision of machine:   see tolsf (=r2) &#39;</span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">tolsf</span><span class="p">)</span>
<span class="w">            </span><span class="n">rwork</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tolsf</span>
<span class="w">            </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">            </span><span class="k">call </span><span class="n">finish</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         endif</span>
<span class="k">      endif</span>

<span class="k">      call </span><span class="n">set_y_and_t</span><span class="p">()</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">4</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">itask</span><span class="o">==</span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ihit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcrit</span>
<span class="w">      </span><span class="k">endif</span>
<span class="k">      call continue</span><span class="p">()</span>

<span class="w">   </span><span class="k">contains</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! block g.</span>
<span class="w">      </span><span class="c">! the following block handles all successful returns from dvode.</span>
<span class="w">      </span><span class="c">! if itask /= 1, y is loaded from yh and t is set accordingly.</span>
<span class="w">      </span><span class="c">! istate is set to 2, and the optional output is loaded into the work</span>
<span class="w">      </span><span class="c">! arrays before returning.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>

<span class="w">      </span><span class="k">subroutine </span><span class="n">set_y_and_t</span><span class="p">()</span>
<span class="w">         </span><span class="c">!! set y vector, t</span>
<span class="w">         </span><span class="k">call </span><span class="n">dcopy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lyh</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span>
<span class="w">      </span><span class="k">end subroutine </span><span class="n">set_y_and_t</span>

<span class="w">      </span><span class="k">subroutine continue</span><span class="p">()</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hu</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nje</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqu</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nlu</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nni</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ncfn</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">netf</span>
<span class="w">      </span><span class="k">end subroutine continue</span>

<span class="k">      subroutine </span><span class="n">ewt_error</span><span class="p">()</span>
<span class="w">         </span><span class="c">!! ewt(i) &lt;= 0.0 for some i (not at start of problem).</span>
<span class="w">         </span><span class="n">ewti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvode--  at t (=r1), ewt(i1) has become r2 &lt;= 0.&#39;</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">xerrwd</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">ewti</span><span class="p">)</span>
<span class="w">         </span><span class="n">istate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span>
<span class="w">      </span><span class="k">end subroutine </span><span class="n">ewt_error</span>

<span class="w">      </span><span class="k">subroutine </span><span class="n">compute_imxer</span><span class="p">()</span>
<span class="w">         </span><span class="c">!! compute imxer if relevant.</span>
<span class="w">         </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">         </span><span class="n">imxer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lacor</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lewt</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">big</span><span class="o">&lt;</span><span class="n">size</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span>
<span class="w">               </span><span class="n">imxer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span>
<span class="w">            </span><span class="k">endif</span>
<span class="k">         enddo</span>
<span class="k">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imxer</span>
<span class="w">      </span><span class="k">end subroutine </span><span class="n">compute_imxer</span>

<span class="w">      </span><span class="k">subroutine </span><span class="n">finish</span><span class="p">()</span>
<span class="w">         </span><span class="c">!! set y vector, t, and optional output.</span>
<span class="w">         </span><span class="k">call </span><span class="n">set_y_and_t</span><span class="p">()</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hu</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">         </span><span class="n">rwork</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nje</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqu</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nlu</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nni</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ncfn</span>
<span class="w">         </span><span class="n">iwork</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">netf</span>
<span class="w">      </span><span class="k">end subroutine </span><span class="n">finish</span>

<span class="w">   </span><span class="k">end subroutine </span><span class="n">dvode</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              dvode
 was developed by Jacob Williams<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>