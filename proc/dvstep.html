<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Modern Fortran Edition of the DVODE ODE Solver">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>dvstep &ndash; dvode</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">dvode </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>dvstep
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title="13.6% of total for procedures.">285 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/dvode_module.F90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/dvode_module.f90.html'>dvode_module.F90</a></li>
                <li class="breadcrumb-item"><a href='../module/dvode_module.html'>dvode_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">dvstep</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/dvstep.html#src">dvstep</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine dvstep(me, y, yh, ldyh, yh1, ewt, savf, vsav, acor, wm, iwm)  
</h2>
    

    <p>dvstep performs one step of the integration of an initial value
problem for a system of ordinary differential equations.</p>
<p>dvstep calls subroutine <a href="../proc/dvnlsd.html">dvnlsd</a> for the solution of the nonlinear system
arising in the time step.  thus it is independent of the problem
jacobian structure and the type of nonlinear system solution method.
dvstep returns a completion flag kflag (in common).
a return with kflag = -1 or -2 means either abs(h) = hmin or 10
consecutive failures occurred.  on a return with kflag negative,
the values of tn and the yh array are as of the beginning of the last
step, and h is the last step size attempted.</p>

    <h3>Type Bound</h3>
    <p><a href='../type/dvode_t.html'>dvode_t</a></p>

    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-me~9"></span>
              class(<a href='../type/dvode_t.html'>dvode_t</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>me</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-y~5"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>y</strong>(*)</td>
            <td>
                <p>an array of length n used for the dependent variable vector.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-yh~2"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>yh</strong>(ldyh,*)</td>
            <td>
                <p>an ldyh by lmax array containing the dependent variables
and their approximate scaled derivatives, where
lmax = maxord + 1.  yh(i,j+1) contains the approximate
j-th derivative of y(i), scaled by h**j/factorial(j)
(j = 0,1,...,nq).  on entry for the first step, the first
two columns of yh must be set from the initial values.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldyh~2"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ldyh</strong></td>
            <td>
                <p>a constant integer &gt;= n, the first dimension of yh.
n is the number of odes in the system.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-yh1"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>yh1</strong>(*)</td>
            <td>
                <p>a one-dimensional array occupying the same space as yh.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ewt~3"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ewt</strong>(*)</td>
            <td>
                <p>an array of length n containing multiplicative weights
for local error measurements.  local errors in y(i) are
compared to 1.0/ewt(i) in various error tests.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-savf"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>savf</strong>(*)</td>
            <td>
                <p>an array of working storage, of length n.
also used for input of yh(*,maxord+2) when jstart = -1
and maxord &lt; the current order nq.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-vsav"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>vsav</strong>(*)</td>
            <td>
                <p>a work array of length n passed to subroutine <a href="../proc/dvnlsd.html">dvnlsd</a>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-acor"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>acor</strong>(*)</td>
            <td>
                <p>a work array of length n, used for the accumulated
corrections.  on a successful return, acor(i) contains
the estimated one-step local error in y(i).</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wm"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>wm</strong>(*)</td>
            <td>
                <p>real work array associated with matrix
operations in <a href="../proc/dvnlsd.html">dvnlsd</a>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwm"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iwm</strong>(*)</td>
            <td>
                <p>integer work array associated with matrix
operations in <a href="../proc/dvnlsd.html">dvnlsd</a>.</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~dvstep~~CallsGraph Pages: 1 -->
<svg id="procdvstepCallsGraph" width="555pt" height="458pt"
 viewBox="0.00 0.00 555.00 458.26" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~dvstep~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 454.26)">
<title>proc~~dvstep~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-454.26 551,-454.26 551,4 -4,4"/>
<!-- proc~dvstep -->
<g id="proc~~dvstep~~CallsGraph_node1" class="node">
<title>proc~dvstep</title>
<polygon fill="none" stroke="black" points="100,-194 0,-194 0,-170 100,-170 100,-194"/>
<text text-anchor="middle" x="50" y="-179.6" font-family="Helvetica,sans-Serif" font-size="10.50">dvode_t%dvstep</text>
</g>
<!-- proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_node2" class="node">
<title>proc~daxpy</title>
<g id="a_proc~~dvstep~~CallsGraph_node2"><a xlink:href="../proc/daxpy.html" xlink:title="daxpy">
<polygon fill="#d9534f" stroke="#d9534f" points="547,-144 493,-144 493,-120 547,-120 547,-144"/>
<text text-anchor="middle" x="520" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">daxpy</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge1" class="edge">
<title>proc~dvstep&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M100.2,-176.74C194.72,-166.64 399.7,-144.75 482.86,-135.86"/>
<polygon fill="#000000" stroke="#000000" points="483.27,-139.34 492.84,-134.79 482.53,-132.38 483.27,-139.34"/>
</g>
<!-- proc~dcopy -->
<g id="proc~~dvstep~~CallsGraph_node3" class="node">
<title>proc~dcopy</title>
<g id="a_proc~~dvstep~~CallsGraph_node3"><a xlink:href="../proc/dcopy.html" xlink:title="dcopy">
<polygon fill="#d9534f" stroke="#d9534f" points="547,-440 493,-440 493,-416 547,-416 547,-440"/>
<text text-anchor="middle" x="520" y="-425.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dcopy</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dcopy -->
<g id="proc~~dvstep~~CallsGraph_edge2" class="edge">
<title>proc~dvstep&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M56.09,-194C67.42,-219.69 96.87,-280.93 136,-321 185.87,-372.07 206.01,-378.48 271,-408 347.82,-442.9 373.47,-457.88 457,-446 465.61,-444.77 474.7,-442.64 483.19,-440.25"/>
<polygon fill="#000000" stroke="#000000" points="484.23,-443.6 492.81,-437.38 482.23,-436.89 484.23,-443.6"/>
</g>
<!-- proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_node4" class="node">
<title>proc~dscal</title>
<g id="a_proc~~dvstep~~CallsGraph_node4"><a xlink:href="../proc/dscal.html" xlink:title="dscal">
<polygon fill="#d9534f" stroke="#d9534f" points="547,-304 493,-304 493,-280 547,-280 547,-304"/>
<text text-anchor="middle" x="520" y="-289.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dscal</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_edge3" class="edge">
<title>proc~dvstep&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M61.85,-194.23C101.73,-238.09 246.13,-387.07 403,-429 426.19,-435.2 436.83,-442.01 457,-429 496.45,-403.55 511.07,-346.27 516.28,-314.42"/>
<polygon fill="#000000" stroke="#000000" points="519.77,-314.72 517.75,-304.31 512.84,-313.7 519.77,-314.72"/>
</g>
<!-- proc~dvjust -->
<g id="proc~~dvstep~~CallsGraph_node5" class="node">
<title>proc~dvjust</title>
<g id="a_proc~~dvstep~~CallsGraph_node5"><a xlink:href="../proc/dvjust.html" xlink:title="dvode_t%dvjust">
<polygon fill="#d9534f" stroke="#d9534f" points="367,-104 271,-104 271,-80 367,-80 367,-104"/>
<text text-anchor="middle" x="319" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvjust</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvjust -->
<g id="proc~~dvstep~~CallsGraph_edge4" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvjust</title>
<path fill="none" stroke="#000000" d="M62.97,-169.79C78.37,-154.89 106.66,-130.19 136,-118 175.61,-101.55 223.78,-95.21 260.61,-92.89"/>
<polygon fill="#000000" stroke="#000000" points="260.89,-96.38 270.68,-92.34 260.5,-89.39 260.89,-96.38"/>
</g>
<!-- proc~dvnlsd -->
<g id="proc~~dvstep~~CallsGraph_node6" class="node">
<title>proc~dvnlsd</title>
<g id="a_proc~~dvstep~~CallsGraph_node6"><a xlink:href="../proc/dvnlsd.html" xlink:title="dvode_t%dvnlsd">
<polygon fill="#d9534f" stroke="#d9534f" points="235,-244 136,-244 136,-220 235,-220 235,-244"/>
<text text-anchor="middle" x="185.5" y="-229.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvnlsd</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvnlsd -->
<g id="proc~~dvstep~~CallsGraph_edge5" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvnlsd</title>
<path fill="none" stroke="#000000" d="M83.32,-194.1C101.14,-200.78 123.48,-209.14 142.62,-216.32"/>
<polygon fill="#000000" stroke="#000000" points="141.43,-219.6 152.02,-219.83 143.88,-213.05 141.43,-219.6"/>
</g>
<!-- proc~dvset -->
<g id="proc~~dvstep~~CallsGraph_node7" class="node">
<title>proc~dvset</title>
<g id="a_proc~~dvstep~~CallsGraph_node7"><a xlink:href="../proc/dvset.html" xlink:title="dvode_t%dvset">
<polygon fill="#d9534f" stroke="#d9534f" points="232,-66 139,-66 139,-42 232,-42 232,-66"/>
<text text-anchor="middle" x="185.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvset</text>
</a>
</g>
</g>
<!-- proc~dvstep&#45;&gt;proc~dvset -->
<g id="proc~~dvstep~~CallsGraph_edge6" class="edge">
<title>proc~dvstep&#45;&gt;proc~dvset</title>
<path fill="none" stroke="#000000" d="M58.92,-169.7C72.64,-149.11 102.59,-107.24 136,-80 139.97,-76.76 144.41,-73.74 148.94,-70.99"/>
<polygon fill="#000000" stroke="#000000" points="150.7,-74.01 157.67,-66.03 147.25,-67.92 150.7,-74.01"/>
</g>
<!-- proc~dvjust&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge7" class="edge">
<title>proc~dvjust&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M367,-100.51C393.48,-105.4 427.13,-111.8 457,-118 465.37,-119.74 474.36,-121.71 482.82,-123.61"/>
<polygon fill="#000000" stroke="#000000" points="482.27,-127.07 492.8,-125.87 483.82,-120.25 482.27,-127.07"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge8" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M226.61,-219.94C291.89,-200.3 420.13,-161.74 482.8,-142.89"/>
<polygon fill="#000000" stroke="#000000" points="484.06,-146.16 492.63,-139.93 482.05,-139.46 484.06,-146.16"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dcopy -->
<g id="proc~~dvstep~~CallsGraph_edge9" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M192.71,-244.31C205.03,-267.78 234.54,-319.59 271,-353 320.91,-398.74 337.6,-411.52 403,-429 428.98,-435.95 459.43,-435.37 482.6,-433.24"/>
<polygon fill="#000000" stroke="#000000" points="483.12,-436.7 492.7,-432.16 482.39,-429.74 483.12,-436.7"/>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_edge10" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M235.02,-241.54C278.85,-250.08 345.17,-262.79 403,-273 429.66,-277.71 459.85,-282.64 482.74,-286.3"/>
<polygon fill="#000000" stroke="#000000" points="482.28,-289.77 492.71,-287.88 483.38,-282.86 482.28,-289.77"/>
</g>
<!-- proc~dvjac -->
<g id="proc~~dvstep~~CallsGraph_node8" class="node">
<title>proc~dvjac</title>
<g id="a_proc~~dvstep~~CallsGraph_node8"><a xlink:href="../proc/dvjac.html" xlink:title="dvode_t%dvjac">
<polygon fill="#d9534f" stroke="#d9534f" points="365.5,-344 272.5,-344 272.5,-320 365.5,-320 365.5,-344"/>
<text text-anchor="middle" x="319" y="-329.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvjac</text>
</a>
</g>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dvjac -->
<g id="proc~~dvstep~~CallsGraph_edge11" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dvjac</title>
<path fill="none" stroke="#000000" d="M198.68,-244.18C214.51,-259.63 243.39,-286.61 271,-306 275.37,-309.07 280.14,-312.07 284.91,-314.87"/>
<polygon fill="#000000" stroke="#000000" points="283.55,-318.12 293.97,-319.99 286.99,-312.03 283.55,-318.12"/>
</g>
<!-- proc~dvsol -->
<g id="proc~~dvstep~~CallsGraph_node9" class="node">
<title>proc~dvsol</title>
<g id="a_proc~~dvstep~~CallsGraph_node9"><a xlink:href="../proc/dvsol.html" xlink:title="dvode_t%dvsol">
<polygon fill="#d9534f" stroke="#d9534f" points="365,-62 273,-62 273,-38 365,-38 365,-62"/>
<text text-anchor="middle" x="319" y="-47.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvsol</text>
</a>
</g>
</g>
<!-- proc~dvnlsd&#45;&gt;proc~dvsol -->
<g id="proc~~dvstep~~CallsGraph_edge12" class="edge">
<title>proc~dvnlsd&#45;&gt;proc~dvsol</title>
<path fill="none" stroke="#000000" d="M189.86,-219.79C198.52,-190.4 224.28,-114.86 271,-71 272.25,-69.82 273.59,-68.7 274.98,-67.64"/>
<polygon fill="#000000" stroke="#000000" points="276.96,-70.53 283.44,-62.15 273.15,-64.65 276.96,-70.53"/>
</g>
<!-- proc~dvjac&#45;&gt;proc~dcopy -->
<g id="proc~~dvstep~~CallsGraph_edge14" class="edge">
<title>proc~dvjac&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M355.5,-344.01C383.69,-354.07 423.75,-369.56 457,-387 469.81,-393.72 483.28,-402.41 494.38,-410.06"/>
<polygon fill="#000000" stroke="#000000" points="492.52,-413.03 502.72,-415.91 496.55,-407.3 492.52,-413.03"/>
</g>
<!-- proc~dvjac&#45;&gt;proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_edge17" class="edge">
<title>proc~dvjac&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M365.74,-323.73C392.41,-318.8 426.66,-312.3 457,-306 465.37,-304.26 474.36,-302.29 482.82,-300.39"/>
<polygon fill="#000000" stroke="#000000" points="483.82,-303.75 492.8,-298.13 482.27,-296.93 483.82,-303.75"/>
</g>
<!-- proc~dacopy -->
<g id="proc~~dvstep~~CallsGraph_node10" class="node">
<title>proc~dacopy</title>
<g id="a_proc~~dvstep~~CallsGraph_node10"><a xlink:href="../proc/dacopy.html" xlink:title="dacopy">
<polygon fill="#d9534f" stroke="#d9534f" points="457,-420 403,-420 403,-396 457,-396 457,-420"/>
<text text-anchor="middle" x="430" y="-405.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dacopy</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dacopy -->
<g id="proc~~dvstep~~CallsGraph_edge13" class="edge">
<title>proc~dvjac&#45;&gt;proc~dacopy</title>
<path fill="none" stroke="#000000" d="M337.51,-344.21C355.23,-356.56 382.83,-375.8 403.08,-389.93"/>
<polygon fill="#000000" stroke="#000000" points="401.33,-392.97 411.53,-395.82 405.33,-387.23 401.33,-392.97"/>
</g>
<!-- proc~dgbfa -->
<g id="proc~~dvstep~~CallsGraph_node11" class="node">
<title>proc~dgbfa</title>
<g id="a_proc~~dvstep~~CallsGraph_node11"><a xlink:href="../proc/dgbfa.html" xlink:title="dgbfa">
<polygon fill="#d9534f" stroke="#d9534f" points="457,-264 403,-264 403,-240 457,-240 457,-264"/>
<text text-anchor="middle" x="430" y="-249.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgbfa</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dgbfa -->
<g id="proc~~dvstep~~CallsGraph_edge15" class="edge">
<title>proc~dvjac&#45;&gt;proc~dgbfa</title>
<path fill="none" stroke="#000000" d="M336.55,-319.85C354.59,-306.62 383.62,-285.31 404.33,-270.1"/>
<polygon fill="#000000" stroke="#000000" points="406.66,-272.74 412.65,-264 402.51,-267.1 406.66,-272.74"/>
</g>
<!-- proc~dgefa -->
<g id="proc~~dvstep~~CallsGraph_node13" class="node">
<title>proc~dgefa</title>
<g id="a_proc~~dvstep~~CallsGraph_node13"><a xlink:href="../proc/dgefa.html" xlink:title="dgefa">
<polygon fill="#d9534f" stroke="#d9534f" points="457,-222 403,-222 403,-198 457,-198 457,-222"/>
<text text-anchor="middle" x="430" y="-207.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgefa</text>
</a>
</g>
</g>
<!-- proc~dvjac&#45;&gt;proc~dgefa -->
<g id="proc~~dvstep~~CallsGraph_edge16" class="edge">
<title>proc~dvjac&#45;&gt;proc~dgefa</title>
<path fill="none" stroke="#000000" d="M328.73,-319.82C343.12,-300.14 373.18,-260.56 403,-231 403.67,-230.34 404.35,-229.68 405.05,-229.02"/>
<polygon fill="#000000" stroke="#000000" points="407.66,-231.39 412.88,-222.17 403.05,-226.12 407.66,-231.39"/>
</g>
<!-- proc~dgbsl -->
<g id="proc~~dvstep~~CallsGraph_node12" class="node">
<title>proc~dgbsl</title>
<g id="a_proc~~dvstep~~CallsGraph_node12"><a xlink:href="../proc/dgbsl.html" xlink:title="dgbsl">
<polygon fill="#d9534f" stroke="#d9534f" points="457,-66 403,-66 403,-42 457,-42 457,-66"/>
<text text-anchor="middle" x="430" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgbsl</text>
</a>
</g>
</g>
<!-- proc~dvsol&#45;&gt;proc~dgbsl -->
<g id="proc~~dvstep~~CallsGraph_edge18" class="edge">
<title>proc~dvsol&#45;&gt;proc~dgbsl</title>
<path fill="none" stroke="#000000" d="M365.28,-51.66C374.34,-51.99 383.76,-52.34 392.48,-52.66"/>
<polygon fill="#000000" stroke="#000000" points="392.59,-56.17 402.71,-53.04 392.85,-49.17 392.59,-56.17"/>
</g>
<!-- proc~dgesl -->
<g id="proc~~dvstep~~CallsGraph_node14" class="node">
<title>proc~dgesl</title>
<g id="a_proc~~dvstep~~CallsGraph_node14"><a xlink:href="../proc/dgesl.html" xlink:title="dgesl">
<polygon fill="#d9534f" stroke="#d9534f" points="457,-24 403,-24 403,0 457,0 457,-24"/>
<text text-anchor="middle" x="430" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dgesl</text>
</a>
</g>
</g>
<!-- proc~dvsol&#45;&gt;proc~dgesl -->
<g id="proc~~dvstep~~CallsGraph_edge19" class="edge">
<title>proc~dvsol&#45;&gt;proc~dgesl</title>
<path fill="none" stroke="#000000" d="M354.49,-37.98C366.79,-33.69 380.68,-28.85 393.1,-24.52"/>
<polygon fill="#000000" stroke="#000000" points="394.39,-27.77 402.68,-21.17 392.09,-21.16 394.39,-27.77"/>
</g>
<!-- proc~dacopy&#45;&gt;proc~dcopy -->
<g id="proc~~dvstep~~CallsGraph_edge20" class="edge">
<title>proc~dacopy&#45;&gt;proc~dcopy</title>
<path fill="none" stroke="#000000" d="M457.4,-414C465.48,-415.84 474.51,-417.89 483.1,-419.84"/>
<polygon fill="#000000" stroke="#000000" points="482.39,-423.27 492.92,-422.07 483.94,-416.44 482.39,-423.27"/>
</g>
<!-- proc~dgbfa&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge21" class="edge">
<title>proc~dgbfa&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M447.69,-239.89C450.96,-237.15 454.23,-234.13 457,-231 478.49,-206.77 497.3,-174.24 508.4,-153.2"/>
<polygon fill="#000000" stroke="#000000" points="511.6,-154.63 513.08,-144.14 505.38,-151.42 511.6,-154.63"/>
</g>
<!-- proc~dgbfa&#45;&gt;proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_edge22" class="edge">
<title>proc~dgbfa&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M457.4,-264C465.66,-267.75 474.9,-271.95 483.66,-275.94"/>
<polygon fill="#000000" stroke="#000000" points="482.37,-279.19 492.92,-280.14 485.26,-272.82 482.37,-279.19"/>
</g>
<!-- proc~idamax -->
<g id="proc~~dvstep~~CallsGraph_node16" class="node">
<title>proc~idamax</title>
<g id="a_proc~~dvstep~~CallsGraph_node16"><a xlink:href="../proc/idamax.html" xlink:title="idamax">
<polygon fill="#d94e8f" stroke="#d94e8f" points="547,-242 493,-242 493,-218 547,-218 547,-242"/>
<text text-anchor="middle" x="520" y="-227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">idamax</text>
</a>
</g>
</g>
<!-- proc~dgbfa&#45;&gt;proc~idamax -->
<g id="proc~~dvstep~~CallsGraph_edge23" class="edge">
<title>proc~dgbfa&#45;&gt;proc~idamax</title>
<path fill="none" stroke="#000000" d="M457.4,-245.4C465.48,-243.38 474.51,-241.12 483.1,-238.97"/>
<polygon fill="#000000" stroke="#000000" points="484.07,-242.34 492.92,-236.52 482.37,-235.55 484.07,-242.34"/>
</g>
<!-- proc~dgbsl&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge24" class="edge">
<title>proc~dgbsl&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M444.75,-66.19C458.96,-78.78 481.32,-98.6 497.79,-113.2"/>
<polygon fill="#000000" stroke="#000000" points="495.54,-115.88 505.35,-119.9 500.18,-110.65 495.54,-115.88"/>
</g>
<!-- proc~ddot -->
<g id="proc~~dvstep~~CallsGraph_node15" class="node">
<title>proc~ddot</title>
<g id="a_proc~~dvstep~~CallsGraph_node15"><a xlink:href="../proc/ddot.html" xlink:title="ddot">
<polygon fill="#d94e8f" stroke="#d94e8f" points="547,-45 493,-45 493,-21 547,-21 547,-45"/>
<text text-anchor="middle" x="520" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddot</text>
</a>
</g>
</g>
<!-- proc~dgbsl&#45;&gt;proc~ddot -->
<g id="proc~~dvstep~~CallsGraph_edge25" class="edge">
<title>proc~dgbsl&#45;&gt;proc~ddot</title>
<path fill="none" stroke="#000000" d="M457.4,-47.7C465.48,-45.77 474.51,-43.62 483.1,-41.57"/>
<polygon fill="#000000" stroke="#000000" points="484,-44.95 492.92,-39.22 482.38,-38.14 484,-44.95"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge26" class="edge">
<title>proc~dgefa&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M444.75,-197.81C458.96,-185.22 481.32,-165.4 497.79,-150.8"/>
<polygon fill="#000000" stroke="#000000" points="500.18,-153.35 505.35,-144.1 495.54,-148.12 500.18,-153.35"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~dscal -->
<g id="proc~~dvstep~~CallsGraph_edge27" class="edge">
<title>proc~dgefa&#45;&gt;proc~dscal</title>
<path fill="none" stroke="#000000" d="M446.61,-222.19C450.08,-225.02 453.71,-228.06 457,-231 471.98,-244.36 488.11,-260.28 500.17,-272.51"/>
<polygon fill="#000000" stroke="#000000" points="497.95,-275.25 507.45,-279.95 502.95,-270.36 497.95,-275.25"/>
</g>
<!-- proc~dgefa&#45;&gt;proc~idamax -->
<g id="proc~~dvstep~~CallsGraph_edge28" class="edge">
<title>proc~dgefa&#45;&gt;proc~idamax</title>
<path fill="none" stroke="#000000" d="M457.4,-216C465.48,-217.84 474.51,-219.89 483.1,-221.84"/>
<polygon fill="#000000" stroke="#000000" points="482.39,-225.27 492.92,-224.07 483.94,-218.44 482.39,-225.27"/>
</g>
<!-- proc~dgesl&#45;&gt;proc~daxpy -->
<g id="proc~~dvstep~~CallsGraph_edge29" class="edge">
<title>proc~dgesl&#45;&gt;proc~daxpy</title>
<path fill="none" stroke="#000000" d="M447.69,-24.11C450.96,-26.85 454.23,-29.87 457,-33 478.49,-57.23 497.3,-89.76 508.4,-110.8"/>
<polygon fill="#000000" stroke="#000000" points="505.38,-112.58 513.08,-119.86 511.6,-109.37 505.38,-112.58"/>
</g>
<!-- proc~dgesl&#45;&gt;proc~ddot -->
<g id="proc~~dvstep~~CallsGraph_edge30" class="edge">
<title>proc~dgesl&#45;&gt;proc~ddot</title>
<path fill="none" stroke="#000000" d="M457.4,-18.3C465.48,-20.23 474.51,-22.38 483.1,-24.43"/>
<polygon fill="#000000" stroke="#000000" points="482.38,-27.86 492.92,-26.78 484,-21.05 482.38,-27.86"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~dvstep~~CalledByGraph Pages: 1 -->
<svg id="procdvstepCalledByGraph" width="241pt" height="32pt"
 viewBox="0.00 0.00 241.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~dvstep~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~dvstep~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 237,-28 237,4 -4,4"/>
<!-- proc~dvstep -->
<g id="proc~~dvstep~~CalledByGraph_node1" class="node">
<title>proc~dvstep</title>
<polygon fill="none" stroke="black" points="233,-24 133,-24 133,0 233,0 233,-24"/>
<text text-anchor="middle" x="183" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">dvode_t%dvstep</text>
</g>
<!-- proc~dvode -->
<g id="proc~~dvstep~~CalledByGraph_node2" class="node">
<title>proc~dvode</title>
<g id="a_proc~~dvstep~~CalledByGraph_node2"><a xlink:href="../proc/dvode.html" xlink:title="dvode_t%dvode">
<polygon fill="#d9534f" stroke="#d9534f" points="97,-24 0,-24 0,0 97,0 97,-24"/>
<text text-anchor="middle" x="48.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dvode_t%dvode</text>
</a>
</g>
</g>
<!-- proc~dvode&#45;&gt;proc~dvstep -->
<g id="proc~~dvstep~~CalledByGraph_edge1" class="edge">
<title>proc~dvode&#45;&gt;proc~dvstep</title>
<path fill="none" stroke="#000000" d="M97.34,-12C105.56,-12 114.19,-12 122.67,-12"/>
<polygon fill="#000000" stroke="#000000" points="122.9,-15.5 132.9,-12 122.9,-8.5 122.9,-15.5"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CalledByGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">   </span><span class="k">subroutine </span><span class="n">dvstep</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="n">yh1</span><span class="p">,</span><span class="n">ewt</span><span class="p">,</span><span class="n">savf</span><span class="p">,</span><span class="n">vsav</span><span class="p">,</span><span class="n">acor</span><span class="p">,</span><span class="n">wm</span><span class="p">,</span><span class="n">iwm</span><span class="p">)</span>

<span class="w">      </span><span class="k">class</span><span class="p">(</span><span class="n">dvode_t</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ldyh</span><span class="w"> </span><span class="c">!! a constant integer &gt;= n, the first dimension of yh.</span>
<span class="w">                                 </span><span class="c">!! n is the number of odes in the system.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! an array of length n used for the dependent variable vector.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">yh</span><span class="p">(</span><span class="n">ldyh</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! an ldyh by lmax array containing the dependent variables</span>
<span class="w">                                           </span><span class="c">!! and their approximate scaled derivatives, where</span>
<span class="w">                                           </span><span class="c">!! lmax = maxord + 1.  yh(i,j+1) contains the approximate</span>
<span class="w">                                           </span><span class="c">!! j-th derivative of y(i), scaled by h**j/factorial(j)</span>
<span class="w">                                           </span><span class="c">!! (j = 0,1,...,nq).  on entry for the first step, the first</span>
<span class="w">                                           </span><span class="c">!! two columns of yh must be set from the initial values.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! a one-dimensional array occupying the same space as yh.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ewt</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! an array of length n containing multiplicative weights</span>
<span class="w">                                    </span><span class="c">!! for local error measurements.  local errors in y(i) are</span>
<span class="w">                                    </span><span class="c">!! compared to 1.0/ewt(i) in various error tests.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">savf</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! an array of working storage, of length n.</span>
<span class="w">                          </span><span class="c">!! also used for input of yh(*,maxord+2) when jstart = -1</span>
<span class="w">                          </span><span class="c">!! and maxord &lt; the current order nq.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">vsav</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! a work array of length n passed to subroutine [[dvnlsd]].</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">acor</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! a work array of length n, used for the accumulated</span>
<span class="w">                          </span><span class="c">!! corrections.  on a successful return, acor(i) contains</span>
<span class="w">                          </span><span class="c">!! the estimated one-step local error in y(i).</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wm</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! real work array associated with matrix</span>
<span class="w">                        </span><span class="c">!! operations in [[dvnlsd]].</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwm</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="c">!! integer work array associated with matrix</span>
<span class="w">                        </span><span class="c">!! operations in [[dvnlsd]].</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cnquot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ddn</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">dsm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">dup</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">etaqp1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">flotl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">told</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iback</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ncf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nflag</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">kfc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">kfh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mxncf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">addon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e-6_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bias1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bias2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bias3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etacf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etamin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etamxf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etamx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="mf">0.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etamx2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etamx3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">onepsm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.00001_wp</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">thresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5_wp</span>

<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="n">told</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span>
<span class="w">      </span><span class="n">ncf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jcur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="n">nflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="c">! the following block handles preliminaries needed when jstart = -1.</span>
<span class="w">            </span><span class="c">! if n was reduced, zero out part of yh to avoid undefined references.</span>
<span class="w">            </span><span class="c">! if maxord was reduced to a value less than the tentative order newq,</span>
<span class="w">            </span><span class="c">! then nq is set to maxord, and a new h ratio eta is chosen.</span>
<span class="w">            </span><span class="c">! otherwise, we take the same preliminary actions as for jstart &gt; 0.</span>
<span class="w">            </span><span class="c">! in any case, nqwait is reset to l = nq + 1 to prevent further</span>
<span class="w">            </span><span class="c">! changes in order for that many steps.</span>
<span class="w">            </span><span class="c">! the new h ratio eta is limited by the input h if kuth = 1,</span>
<span class="w">            </span><span class="c">! by hmin if kuth = 0, and by hmxi in any case.</span>
<span class="w">            </span><span class="c">! finally, the history array yh is rescaled.</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="o">/=</span><span class="n">ldyh</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ldyh</span>
<span class="w">               </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ldyh</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i1</span><span class="o">&lt;=</span><span class="n">i2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i2</span>
<span class="w">                     </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                  </span><span class="k">enddo</span>
<span class="k">               endif</span>
<span class="k">            endif</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">&gt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">flotl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">&lt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">ddn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dvnorm</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">savf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">ewt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias1</span><span class="o">*</span><span class="n">ddn</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">flotl</span><span class="p">)</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaq</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvjust</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">ddn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dvnorm</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">savf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">ewt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias1</span><span class="o">*</span><span class="n">ddn</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">flotl</span><span class="p">)</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvjust</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">one</span><span class="p">)</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span>
<span class="w">            </span><span class="k">endif</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="p">))</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">one</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">)</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">&gt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">300</span>
<span class="w">         </span><span class="k">else</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="c">! on the first call, the order is set to 1, and other variables are</span>
<span class="w">            </span><span class="c">! initialized.  etamax is the maximum ratio by which h can be increased</span>
<span class="w">            </span><span class="c">! in a single step.  it is normally 10, but is larger during the</span>
<span class="w">            </span><span class="c">! first step to compensate for the small initial h.  if a failure</span>
<span class="w">            </span><span class="c">! occurs (in corrector convergence or error test), etamax is set to 1</span>
<span class="w">            </span><span class="c">! for the next increase.</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">maxord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">*</span><span class="n">ldyh</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">prl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etamx1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="mi">400</span>
<span class="w">         </span><span class="k">end if</span>

<span class="k">      else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kuth</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="c">! take preliminary actions on a normal continuation step (jstart&gt;0).</span>
<span class="w">         </span><span class="c">! if the driver changed h, then eta must be reset and newh set to 1.</span>
<span class="w">         </span><span class="c">! if a change of order was dictated on the previous step, then</span>
<span class="w">         </span><span class="c">! it is done here and appropriate adjustments in the history are made.</span>
<span class="w">         </span><span class="c">! on an order decrease, the history array is adjusted by dvjust.</span>
<span class="w">         </span><span class="c">! on an order increase, the history array is augmented by a column.</span>
<span class="w">         </span><span class="c">! on a change of step size h, the history array yh is rescaled.</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="p">)</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">endif</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">400</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">&lt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">me</span><span class="p">%</span><span class="n">dvjust</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">      </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="o">&gt;</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">me</span><span class="p">%</span><span class="n">dvjust</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">      </span><span class="k">endif</span>

<span class="w">      </span><span class="c">! rescale the history array for a change in h by a factor of eta. ------</span>
<span class="w"> </span><span class="mi">300</span><span class="w">  </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">      </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">         </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span>
<span class="w">         </span><span class="k">call </span><span class="n">dscal</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">yh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">enddo</span>
<span class="k">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rc</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">*</span><span class="n">ldyh</span>

<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">      </span><span class="c">! this section computes the predicted values by effectively</span>
<span class="w">      </span><span class="c">! multiplying the yh array by the pascal triangle matrix.</span>
<span class="w">      </span><span class="c">! dvset is called to calculate all integration coefficients.</span>
<span class="w">      </span><span class="c">! rc is the ratio of new to old values of the coefficient h/el(2)=h/l1.</span>
<span class="w">      </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w"> </span><span class="mi">400</span><span class="w">  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">      </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">do </span><span class="n">jb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">         </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ldyh</span>
<span class="w">         </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span>
<span class="w">            </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">ldyh</span><span class="p">)</span>
<span class="w">         </span><span class="k">enddo</span>
<span class="k">      enddo</span>
<span class="k">      call </span><span class="n">me</span><span class="p">%</span><span class="n">dvset</span><span class="p">()</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">el</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rc</span><span class="o">*</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rl1</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">prl1</span><span class="p">)</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">prl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">rl1</span>

<span class="w">      </span><span class="c">! call the nonlinear system solver. ------------------------------------</span>
<span class="w">      </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvnlsd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="n">vsav</span><span class="p">,</span><span class="n">savf</span><span class="p">,</span><span class="n">ewt</span><span class="p">,</span><span class="n">acor</span><span class="p">,</span><span class="n">iwm</span><span class="p">,</span><span class="n">wm</span><span class="p">,</span><span class="n">nflag</span><span class="p">)</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nflag</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="c">! the corrector has converged (nflag = 0).  the local error test is</span>
<span class="w">         </span><span class="c">! made and control passes to statement 500 if it fails.</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="n">dsm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">acnrm</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">dsm</span><span class="o">&gt;</span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="c">! the error test failed.  kflag keeps track of multiple failures.</span>
<span class="w">            </span><span class="c">! restore tn and the yh array to their previous values, and prepare</span>
<span class="w">            </span><span class="c">! to try the step again.  compute the optimum step size for the</span>
<span class="w">            </span><span class="c">! same order.  after repeated failures, h is forced to decrease</span>
<span class="w">            </span><span class="c">! more rapidly.</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">netf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">netf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">nflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">told</span>
<span class="w">            </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">do </span><span class="n">jb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">               </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ldyh</span>
<span class="w">               </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span>
<span class="w">                  </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">ldyh</span><span class="p">)</span>
<span class="w">               </span><span class="k">enddo</span>
<span class="k">            enddo</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">*</span><span class="n">onepsm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="c">! all returns are made through this section.</span>
<span class="w">               </span><span class="c">! on a successful return, etamax is reset and acor is scaled.</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">               </span><span class="k">return</span>
<span class="k">            else</span>
<span class="k">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="o">&gt;</span><span class="n">kfc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                  </span><span class="c">! compute ratio of new h to current h at the current order. ------------</span>
<span class="w">                  </span><span class="n">flotl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias2</span><span class="o">*</span><span class="n">dsm</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">flotl</span><span class="p">)</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">),</span><span class="n">etamin</span><span class="p">)</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="o">&lt;=-</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="o">&gt;</span><span class="n">etamxf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etamxf</span>
<span class="w">                  </span><span class="k">goto</span><span class="w"> </span><span class="mi">300</span>
<span class="w">                  </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">                  </span><span class="c">! control reaches this section if 3 or more consecutive failures</span>
<span class="w">                  </span><span class="c">! have occurred.  it is assumed that the elements of the yh array</span>
<span class="w">                  </span><span class="c">! have accumulated errors of the wrong order.  the order is reduced</span>
<span class="w">                  </span><span class="c">! by one, if possible.  then h is reduced by a factor of 0.1 and</span>
<span class="w">                  </span><span class="c">! the step is retried.  after a total of 7 consecutive failures,</span>
<span class="w">                  </span><span class="c">! an exit is taken with kflag = -1.</span>
<span class="w">                  </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="o">==</span><span class="n">kfh</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">etamin</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">))</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">savf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">))</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nfe</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                  </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">                     </span><span class="n">yh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">*</span><span class="n">savf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                  </span><span class="k">enddo</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">                  </span><span class="k">goto</span><span class="w"> </span><span class="mi">400</span>
<span class="w">               </span><span class="k">else</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">etamin</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">))</span>
<span class="w">                  </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">dvjust</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">ldyh</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">                  </span><span class="k">goto</span><span class="w"> </span><span class="mi">300</span>
<span class="w">               </span><span class="k">endif</span>
<span class="k">            endif</span>
<span class="k">         else</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="c">! after a successful step, update the yh and tau arrays and decrement</span>
<span class="w">            </span><span class="c">! nqwait.  if nqwait is then 1 and nq &lt; maxord, then acor is saved</span>
<span class="w">            </span><span class="c">! for use in a possible order increase on the next step.</span>
<span class="w">            </span><span class="c">! if etamax = 1 (a failure occurred this step), keep nqwait &gt;= 2.</span>
<span class="w">            </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">            </span><span class="k">do </span><span class="n">iback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">               </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">iback</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">enddo</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">               </span><span class="k">call </span><span class="n">daxpy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">el</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">acor</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">yh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="k">enddo</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="o">/=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               call </span><span class="n">dcopy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">acor</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">yh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">conp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">            </span><span class="k">endif</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="o">/=</span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="c">! if nqwait = 0, an increase or decrease in order by one is considered.</span>
<span class="w">               </span><span class="c">! factors etaq, etaqm1, etaqp1 are computed by which h could</span>
<span class="w">               </span><span class="c">! be multiplied at order q, q-1, or q+1, respectively.</span>
<span class="w">               </span><span class="c">! the largest of these is determined, and the new order and</span>
<span class="w">               </span><span class="c">! step size set accordingly.</span>
<span class="w">               </span><span class="c">! a change of h or nq is made only if h increases by at least a</span>
<span class="w">               </span><span class="c">! factor of thresh.  if an order change is considered and rejected,</span>
<span class="w">               </span><span class="c">! then nqwait is set to 2 (reconsider it after 2 steps).</span>
<span class="w">               </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">               </span><span class="c">! compute ratio of new h to current h at the current order. ------------</span>
<span class="w">               </span><span class="n">flotl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">etaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias2</span><span class="o">*</span><span class="n">dsm</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">flotl</span><span class="p">)</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">                  </span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="o">/=</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                     </span><span class="c">! compute ratio of new h to current h at the current order less one. ---</span>
<span class="w">                     </span><span class="n">ddn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dvnorm</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">yh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="p">),</span><span class="n">ewt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                     </span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias1</span><span class="o">*</span><span class="n">ddn</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="p">(</span><span class="n">flotl</span><span class="o">-</span><span class="n">one</span><span class="p">))</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">                  </span><span class="k">endif</span>
<span class="k">                  </span><span class="n">etaqp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span><span class="o">/=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                     </span><span class="c">! compute ratio of new h to current h at current order plus one. -------</span>
<span class="w">                     </span><span class="n">cnquot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">conp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tau</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">l</span>
<span class="w">                     </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span>
<span class="w">                        </span><span class="n">savf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cnquot</span><span class="o">*</span><span class="n">yh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="p">)</span>
<span class="w">                     </span><span class="k">enddo</span>
<span class="k">                     </span><span class="n">dup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dvnorm</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">savf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">),</span><span class="n">ewt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">                     </span><span class="n">etaqp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">((</span><span class="n">bias3</span><span class="o">*</span><span class="n">dup</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="p">(</span><span class="n">flotl</span><span class="o">+</span><span class="n">one</span><span class="p">))</span><span class="o">+</span><span class="n">addon</span><span class="p">)</span>
<span class="w">                  </span><span class="k">endif</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaq</span><span class="o">&lt;</span><span class="n">etaqp1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">etaqp1</span><span class="o">&lt;=</span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">420</span>
<span class="w">                     </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etaqp1</span>
<span class="w">                     </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                     </span><span class="k">call </span><span class="n">dcopy</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">acor</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">yh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">lmax</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                     </span><span class="k">goto</span><span class="w"> </span><span class="mi">450</span>
<span class="w">                  </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaq</span><span class="o">&lt;</span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                     goto</span><span class="w"> </span><span class="mi">420</span>
<span class="w">                  </span><span class="k">endif</span>
<span class="k">               endif</span>
<span class="k">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaq</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">               </span><span class="k">goto</span><span class="w"> </span><span class="mi">450</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="o">&lt;</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqwait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">               </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">               </span><span class="k">goto</span><span class="w"> </span><span class="mi">500</span>
<span class="w">            </span><span class="k">endif</span>
<span class="k"> </span><span class="mi">420</span><span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">etaqm1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="k">endif</span>

<span class="w">         </span><span class="c">! test tentative new h against thresh, etamax, and hmxi, then exit. ----</span>
<span class="w"> </span><span class="mi">450</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="o">&lt;</span><span class="n">thresh</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="o">==</span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span>
<span class="w">         </span><span class="k">else</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="p">)</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">one</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmxi</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">)</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">newh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span>
<span class="w">         </span><span class="k">endif</span>
<span class="k">      else</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="c">! the vnls routine failed to achieve convergence (nflag /= 0).</span>
<span class="w">         </span><span class="c">! the yh array is retracted to its values before prediction.</span>
<span class="w">         </span><span class="c">! the step size h is reduced and the step is retried, if possible.</span>
<span class="w">         </span><span class="c">! otherwise, an error exit is taken.</span>
<span class="w">         </span><span class="c">!-----------------------------------------------------------------------</span>
<span class="w">         </span><span class="n">ncf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ncfn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">ncfn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">told</span>
<span class="w">         </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="k">do </span><span class="n">jb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nq</span>
<span class="w">            </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ldyh</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nqnyh</span>
<span class="w">               </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yh1</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">ldyh</span><span class="p">)</span>
<span class="w">            </span><span class="k">enddo</span>
<span class="k">         enddo</span>
<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nflag</span><span class="o">&lt;-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nflag</span><span class="o">==-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nflag</span><span class="o">==-</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">*</span><span class="n">onepsm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ncf</span><span class="o">==</span><span class="n">mxncf</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">kflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">return</span>
<span class="k">         else</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etacf</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">eta</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">hmin</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">h</span><span class="p">))</span>
<span class="w">            </span><span class="n">nflag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="mi">300</span>
<span class="w">         </span><span class="k">endif</span>
<span class="k">      endif</span>

<span class="k"> </span><span class="mi">500</span><span class="w">  </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etamx3</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">nst</span><span class="o">&lt;=</span><span class="mi">10</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">etamax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etamx2</span>
<span class="w">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">tq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">dscal</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">n</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">acor</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">dat</span><span class="p">%</span><span class="n">jstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">   </span><span class="k">end subroutine </span><span class="n">dvstep</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              dvode
 was developed by Jacob Williams<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>